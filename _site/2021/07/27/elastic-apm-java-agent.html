<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.3.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5">

    <!-- Theme Mode-->
    
    <script>
        const isAutoTheme = false;
        document.documentElement.setAttribute('data-theme', "dark")
    </script>
    

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="Seunghoon Choi" href="http://localhost:4000/feed.xml"/>

    

    <!-- KaTeX 0.13.9 -->
    
    <script defer src="/assets/js/vendor/katex.min.js"></script>
    <script defer src="/assets/js/vendor/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    

    <!-- Mermaid 8.9.2 -->
    
    <script defer src="/assets/js/vendor/mermaid.min.js" onload="mermaid.initialize({startOnLoad:true});"></script>
    

    <!-- Simple Jekyll Search 1.9.1 -->
    <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script>

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-http://localhost:4000';
      const isCookieConsent = 'false';
      const analyticsName = '';
    </script>

    
    

    <!-- seo tags -->
    <meta property="og:image" content="http://localhost:4000/assets/img/contents/eaja-1.png">
    
    <meta property="og:type" content="website" />
    
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Elastic APM Java Agent 적용하기 | Seunghoon Choi</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Elastic APM Java Agent 적용하기" />
<meta name="author" content="csupreme19" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Elastic APM Java Agent 적용하기" />
<meta property="og:description" content="Elastic APM Java Agent 적용하기" />
<link rel="canonical" href="http://localhost:4000/2021/07/27/elastic-apm-java-agent.html" />
<meta property="og:url" content="http://localhost:4000/2021/07/27/elastic-apm-java-agent.html" />
<meta property="og:site_name" content="Seunghoon Choi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-27T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Elastic APM Java Agent 적용하기" />
<script type="application/ld+json">
{"datePublished":"2021-07-27T00:00:00+09:00","description":"Elastic APM Java Agent 적용하기","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/07/27/elastic-apm-java-agent.html"},"url":"http://localhost:4000/2021/07/27/elastic-apm-java-agent.html","author":{"@type":"Person","name":"csupreme19"},"@type":"BlogPosting","headline":"Elastic APM Java Agent 적용하기","dateModified":"2021-07-27T00:00:00+09:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- RSS -->
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seunghoon Choi" />

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Elastic APM Java Agent 적용하기">
    <meta name="twitter:description" content="Elastic APM Java Agent 적용하기Elastic APM Java Agent 적용기APM Agent 설치APM Agentsapm-agent를 사용하기 위해서는 apm-server가 필요하다.apm-server가 구축되어 있지 않으면 Elastic APM Server 문...">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/img/contents/eaja-1.png">
    <meta name="twitter:image:alt" content="Elastic APM Java Agent 적용하기">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        
		<a href="/">
			<img alt="logo img" class="avatar" src="/assets/img/profile-icon.jpeg" />
		</a>
        
        <a class="site-title" aria-label="Seunghoon Choi" href="/">
        Seunghoon Choi
		</a>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fas fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="About" title="About" href="/about/">
                     About 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Gallery" title="Gallery" href="/gallery/">
                     Gallery 
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Portfolio" title="Portfolio" href="/portfolio/">
                     Portfolio 
                </a>
            </li>
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Search" title="Search" href="/search/">
                     <i class="fas fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Tags" title="Tags" href="/tags/">
                     <i class="fas fa-tags" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Elastic+APM+Java+Agent+%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0" class="title">Elastic APM Java Agent 적용하기</h1>
      


<div class="post-info"><a href="https://github.com/csupreme19" target="_blank">
      <img alt="Author's avatar" src="https://avatars.githubusercontent.com/u/76021703?s=400&v=4">
    
    <p class="meta">
      csupreme19 - 
      
      July 27, 2021
    </p></a></div>

      
    </div>
  </header>

  <section class="post-content">
  
      <h1 id="elastic-apm-java-agent-적용하기">Elastic APM Java Agent 적용하기</h1>

<p><img src="/assets/img/titles/elastic-logo.png" alt="elastic-logo.png" /></p>

<p>Elastic APM Java Agent 적용기</p>

<hr />

<h3 id="apm-agent-설치">APM Agent 설치</h3>
<p><a href="https://www.elastic.co/guide/en/apm/agent/index.html">APM Agents</a></p>

<p>apm-agent를 사용하기 위해서는 apm-server가 필요하다.</p>

<p>apm-server가 구축되어 있지 않으면 <a href="/2021/07/22/elastic-apm-server.html">Elastic APM Server</a> 문서 참고</p>

<p>APM Java Agent 공식 지원 설치 방법은 3가지가 있다.</p>

<h4 id="1-manual-setup-with--javaagent-flag">1. Manual setup with -javaagent flag</h4>

<h4 id="2-automatic-setup-with-apm-agent-attach-clijar">2. Automatic setup with apm-agent-attach-cli.jar</h4>

<h4 id="3-programmatic-api-setup-to-self-attach">3. Programmatic API setup to self-attach</h4>

<p>본 문서에서는 최종적으로 아래 <code class="language-plaintext highlighter-rouge">-javaagent</code>와 k8s의 InitContainer를 사용하는 방법을 사용</p>

<h4 id="4--javaagent-flag-with-kubernetes-initcontainer">4. -javaagent flag with Kubernetes InitContainer</h4>

<hr />

<h3 id="manual-setup-with--javaagent-flag">Manual setup with -javaagent flag</h3>
<p><a href="https://www.elastic.co/guide/en/apm/agent/java/current/index.html">APM Java Agent Reference</a></p>

<p>별도 코드 수정이 필요없는 -javaagent 플래그를 이용한 에이전트 설치 방법</p>

<h4 id="1-dockerfile-수정">1. Dockerfile 수정</h4>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> openjdk:8-jre-alpine</span>

<span class="k">ADD</span><span class="s"> your-project/build/libs/*.jar your-project.jar</span>
<span class="k">ADD</span><span class="s"> https://search.maven.org/remotecontent?filepath=co/elastic/apm/elastic-apm-agent/1.25.0/elastic-apm-agent-1.25.0.jar elastic-apm-agent.jar</span>

<span class="k">ENTRYPOINT</span><span class="s"> ["java", "-javaagent:/elastic-apm-agent.jar", "-Delastic.apm.service_name=your-project", "-Delastic.apm.application_packages=com.company.app", "-Delastic.apm.server_url=http://{엘라스틱 APM 서버 주소}:{포트}", "-Delastic.apm.environment=local", "-jar", "your-project.jar"]</span>
</code></pre></div></div>

<blockquote>
  <p>maven repo에서 APM Agent jar를 받아서 -javaagent 플래그로 JVM 위에 같이 실행한다.</p>
</blockquote>

<h5 id="플래그">플래그</h5>
<ul>
  <li>-Delastic.apm.service_name=your-project
    <ul>
      <li>APM 모니터링시 확인할 서비스명(필수)</li>
      <li>APM 메뉴에 표출될 서비스명을 적기</li>
    </ul>
  </li>
  <li>-Delastic.apm.application_packages=com.company.app
    <ul>
      <li>APM 모니터링할 root package(필수)</li>
      <li>APM 모니터링할 Java root package명 적기</li>
    </ul>
  </li>
  <li>-Delastic.apm.server_url=http://{엘라스틱  APM 서버 주소}:{포트}
    <ul>
      <li>APM Server 주소(필수)</li>
      <li>APM Server 엔드포인트</li>
    </ul>
  </li>
  <li>-Delastic.apm.environment=local
    <ul>
      <li>APM 모니터링 환경(옵션)</li>
    </ul>
  </li>
</ul>

<p>그 외 자세한 configuration 값은 <a href="https://www.elastic.co/guide/en/apm/agent/java/current/configuration.html">APM Java Agent Configuration</a> 참고</p>

<h4 id="2-jenkins-빌드">2. Jenkins 빌드</h4>

<h4 id="3-로그-확인">3. 로그 확인</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2021-07-27 14:21:04,144 <span class="o">[</span>main] INFO  co.elastic.apm.agent.util.JmxUtils - Found JVM-specific OperatingSystemMXBean interface: com.sun.management.OperatingSystemMXBean
2021-07-27 14:21:04,535 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - Starting Elastic APM 1.25.0 as your-project on Java 1.8.0_212 Runtime version: 1.8.0_212-b04 VM version: 25.212-b04 <span class="o">(</span>IcedTea<span class="o">)</span> Linux 4.15.0-144-generic
2021-07-27 14:21:04,535 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - environment: <span class="s1">'local'</span> <span class="o">(</span><span class="nb">source</span>: Java System Properties<span class="o">)</span>
2021-07-27 14:21:04,535 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - server_url: <span class="s1">'http://{엘라스틱 APM 서버 주소}:{포트}'</span> <span class="o">(</span><span class="nb">source</span>: Java System Properties<span class="o">)</span>
2021-07-27 14:21:04,536 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - application_packages: <span class="s1">'com.company.app'</span> <span class="o">(</span><span class="nb">source</span>: Java System Properties<span class="o">)</span>
2021-07-27 14:21:11,952 <span class="o">[</span>main] INFO  co.elastic.apm.agent.impl.ElasticApmTracer - Tracer switched to RUNNING state
2021-07-27 14:21:12,340 <span class="o">[</span>elastic-apm-server-healthcheck] INFO  co.elastic.apm.agent.report.ApmServerHealthChecker - Elastic APM server is available: <span class="o">{</span>  <span class="s2">"build_date"</span>: <span class="s2">"2021-04-20T19:55:39Z"</span>,  <span class="s2">"build_sha"</span>: <span class="s2">"32f34ed4298d648bf9476790f2a8a54d72805bb6"</span>,  <span class="s2">"version"</span>: <span class="s2">"7.12.1"</span><span class="o">}</span>
</code></pre></div></div>

<p>Application 시작 전에 위와 같은 로그가 나오면 정상 동작 확인</p>

<hr />

<h3 id="automatic-setup-with-apm-agent-attach-clijar">Automatic setup with apm-agent-attach-cli.jar</h3>

<p><a href="https://www.elastic.co/guide/en/apm/agent/java/current/setup-attach-cli.html#setup-attach-cli-supported-environments">Automatic setup with <code class="language-plaintext highlighter-rouge">apm-agent-attach-cli.jar</code></a></p>

<p>해당 방법은 현재 Host에서 실행되는 모든 JVM에 적용하므로 원하는 서비스만 선택 적용이 어렵다는 단점이 있음</p>

<p>또한 서비스별 config를 적용할 수 있는 가이드가 제공되지 않는다.</p>

<p>APM 서버에서 수집하는 서비스명이 동일하게 나오는 문제가 있음</p>

<p>아래는 모든 k8s worker 노드에 수행되어야함</p>

<h4 id="1-apm-agent-attach-clijar-다운로드">1. apm-agent-attach-cli.jar 다운로드</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget <span class="nt">-v</span> <span class="nt">-O</span> apm-agent-attach-cli-1.25.0.jar https://search.maven.org/remotecontent?filepath<span class="o">=</span>co/elastic/apm/apm-agent-attach-cli/1.25.0/apm-agent-attach-cli-1.25.0.jar
</code></pre></div></div>
<h4 id="2-attachsh-작성">2. <code class="language-plaintext highlighter-rouge">attach.sh</code> 작성</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="nb">set</span> <span class="nt">-ex</span>

attach <span class="o">()</span> <span class="o">{</span>
    <span class="c"># only attempt attachment if this looks like a java container</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="si">$(</span>docker inspect <span class="k">${</span><span class="nv">container_id</span><span class="k">}</span> | jq <span class="nt">--raw-output</span> .[0].Config.Cmd[0]<span class="si">)</span> <span class="o">==</span> java <span class="o">]]</span>
    <span class="k">then
        </span><span class="nb">echo </span>attaching to <span class="si">$(</span>docker ps <span class="nt">--no-trunc</span> | <span class="nb">grep</span> <span class="k">${</span><span class="nv">container_id</span><span class="k">}</span><span class="si">)</span>
        docker <span class="nb">cp</span> ./apm-agent-attach-<span class="k">*</span><span class="nt">-cli</span>.jar <span class="k">${</span><span class="nv">container_id</span><span class="k">}</span>:/apm-agent-attach-cli.jar
        docker <span class="nb">exec</span> <span class="k">${</span><span class="nv">container_id</span><span class="k">}</span> java <span class="nt">-jar</span> /apm-agent-attach-cli.jar <span class="nt">--config</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># attach to running containers</span>
<span class="k">for </span>container_id <span class="k">in</span> <span class="si">$(</span>docker ps <span class="nt">--quiet</span> <span class="nt">--no-trunc</span><span class="si">)</span> <span class="p">;</span> <span class="k">do
    </span>attach
<span class="k">done</span>

<span class="c"># listen for starting containers and attach to those</span>

docker events <span class="nt">--filter</span> <span class="s1">'event=start'</span> <span class="nt">--format</span> <span class="s1">'{{.ID}}'</span> |
<span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> container_id
<span class="k">do
    </span>attach
<span class="k">done</span>

</code></pre></div></div>

<p>현재 구동중인 JVM 컨테이너와 앞으로 구동될 JVM 컨테이너에 java agent attach하는 방법</p>

<h4 id="3-jq-설치">3. jq 설치</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt <span class="nb">install </span>jq
<span class="nv">$ </span>jq <span class="nt">--version</span>
jq-1.5-1-a5b5cbe
</code></pre></div></div>

<p>위 attach 스크립트에서 java를 검사하는 방법은 jq 사용하여 json 검사하는 방법이므로 jq 설치 필요</p>

<h4 id="4-스크립트-실행">4. 스크립트 실행</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chmod</span> +x ./attach.sh
<span class="nv">$ </span>./attach.sh &amp;
</code></pre></div></div>

<hr />

<h3 id="programmatic-api-setup-to-self-attach">Programmatic API setup to self-attach</h3>

<p><a href="https://www.elastic.co/guide/en/apm/agent/java/current/setup-attach-api.html">Programmatic API setup to self-attach</a></p>

<p>소스코드 dependency 추가하여 직접 설정하는 방법</p>

<p>어플리케이션 코드에 직접적인 코드 및 수정이 필요하므로 별로 추천하지는 않는다.</p>

<p>마이크로서비스에서의 많은 서비스들 일일이 추가하기도 어렵고 중복되기 때문</p>

<h4 id="1-pomxml">1. <code class="language-plaintext highlighter-rouge">pom.xml</code></h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>co.elastic.apm<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>apm-agent-attach<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${elastic-apm.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h4 id="2-applicationjava">2. <code class="language-plaintext highlighter-rouge">Application.java</code></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">co.elastic.apm.attach.ElasticApmAttacher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ElasticApmAttacher</span><span class="o">.</span><span class="na">attach</span><span class="o">();</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">MyApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>각 어플리케이션의 java main class에 위 코드를 추가한다.</p>

<hr />

<h3 id="kubernetes-initcontainer사용">Kubernetes InitContainer(사용)</h3>

<p>참고: <a href="https://m.blog.naver.com/olpaemi/221788820388">엘라스틱서치 APM을 이용해서 쿠버네티스 환경의 자바 어플리케이션 모니터링하기(1)</a></p>

<p><code class="language-plaintext highlighter-rouge">-javaagent</code> 와 Kubernetes에서 제공하는 InitContainer 기능을 사용하는 방법</p>

<h4 id="initcontainer">InitContainer</h4>

<div class="mermaid">
flowchart LR
  subgraph Pod
	  A[InitContainer]
    B[Container]
    subgraph Volume
    C[EmptyDir]
  	end
  end
  A--Create--&gt;C
  C-.Delete.-&gt;A
  C--Mount--&gt;B
</div>

<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">Init Containers</a></p>

<p>Deployment 파드 안에 컨테이너 앱 실행 이전에 실행된다.</p>

<p>InitContainer는 항상 실행이 보장되어 있으므로 서비스와 모니터링을 별개의 레벨로 분리할 수 있음</p>

<p>공유 볼륨을 이용하여 apm-agent jar를 공유 볼륨에 넣어놓고</p>

<p>컨테이너 실행시 InitContainer에서 apm-agent jar를 복사하는 방식</p>

<h4 id="kubernetesyaml-수정추가된-부분만-작성"><code class="language-plaintext highlighter-rouge">kubernetes.yaml</code> 수정(추가된 부분만 작성)</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: apps/v1
kind: Deployment
...
spec:
  template:
    metadata:
    ...
    spec:
      initContainers:                        <span class="c"># apm-agent 적용을 위한 initContainer</span>
      - name: elastic-java-agent
        image: docker.elastic.co/observability/apm-agent-java:1.25.0
        volumeMounts:
        - mountPath: /elastic/apm-agent
          name: elastic-apm-agent
        <span class="nb">command</span>: <span class="o">[</span><span class="s1">'cp'</span>, <span class="s1">'-v'</span>, <span class="s1">'/usr/agent/elastic-apm-agent.jar'</span>, <span class="s1">'/elastic/apm-agent'</span><span class="o">]</span>
      containers:
      - name: your-project
        image: abcde
        volumeMounts:
        ...
        - name: elastic-apm-agent
          mountPath: /elastic/apm-agent
        <span class="nb">env</span>:                                <span class="c"># apm-agent 필수 환경변수 추가</span>
        - name: ELASTIC_APM_SERVER_URL 
          value: <span class="s2">"http://{엘라스틱 APM 서버 주소}:{포트}"</span>
        - name: ELASTIC_APM_SERVICE_NAME 
          value: <span class="s2">"your-project"</span>  
        - name: ELASTIC_APM_ENVIRONMENT 
          value: <span class="nb">local</span>
        - name: JAVA_TOOL_OPTIONS
          value: <span class="nt">-javaagent</span>:/elastic/apm-agent/elastic-apm-agent.jar
      ...
      volumes:
      ...
      - name: elastic-apm-agent
        emptyDir: <span class="o">{}</span>
...
</code></pre></div></div>

<p>적용 이후 Jenkins 배포</p>

<h4 id="pod-로그-확인">pod 로그 확인</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Picked up JAVA_TOOL_OPTIONS: <span class="nt">-javaagent</span>:/elastic/apm-agent/elastic-apm-agent.jar
2021-08-04 14:13:53,838 <span class="o">[</span>main] INFO  co.elastic.apm.agent.util.JmxUtils - Found JVM-specific OperatingSystemMXBean interface: com.sun.management.OperatingSystemMXBean
2021-08-04 14:13:54,174 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - Starting Elastic APM 1.25.0 as your-project on Java 1.8.0_212 Runtime version: 1.8.0_212-b04 VM version: 25.212-b04 <span class="o">(</span>IcedTea<span class="o">)</span> Linux 4.15.0-144-generic
2021-08-04 14:13:54,226 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - service_name: <span class="s1">'your-project'</span> <span class="o">(</span><span class="nb">source</span>: Environment Variables<span class="o">)</span>
2021-08-04 14:13:54,227 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - environment: <span class="s1">'local'</span> <span class="o">(</span><span class="nb">source</span>: Environment Variables<span class="o">)</span>
2021-08-04 14:13:54,227 <span class="o">[</span>main] INFO  co.elastic.apm.agent.configuration.StartupInfo - server_url: <span class="s1">'http://{엘라스틱 APM 서버 주소}:{포트}'</span> <span class="o">(</span><span class="nb">source</span>: Environment Variables<span class="o">)</span>
2021-08-04 14:13:54,227 <span class="o">[</span>main] WARN  co.elastic.apm.agent.configuration.StartupInfo - To <span class="nb">enable </span>all features and decrease startup <span class="nb">time</span>, please configure application_packages
2021-08-04 14:14:01,639 <span class="o">[</span>main] INFO  co.elastic.apm.agent.impl.ElasticApmTracer - Tracer switched to RUNNING state
2021-08-04 14:14:02,030 <span class="o">[</span>elastic-apm-server-healthcheck] INFO  co.elastic.apm.agent.report.ApmServerHealthChecker - Elastic APM server is available: <span class="o">{</span>  <span class="s2">"build_date"</span>: <span class="s2">"2021-04-20T19:55:39Z"</span>,  <span class="s2">"build_sha"</span>: <span class="s2">"32f34ed4298d648bf9476790f2a8a54d72805bb6"</span>,  <span class="s2">"version"</span>: <span class="s2">"7.12.1"</span><span class="o">}</span>
</code></pre></div></div>

<p>apm-server 접속 및 available 확인</p>

<h3 id="kibana-확인">Kibana 확인</h3>

<p><img src="/assets/img/contents/eaja-1.png" alt="eaja-1.png" /></p>

<p><img src="/assets/img/contents/eaja-2.png" alt="eaja-2.png" /></p>

<p><img src="/assets/img/contents/eaja-3.png" alt="eaja-3.png" /></p>

<p><img src="/assets/img/contents/eaja-4.png" alt="eaja-4.png" /></p>

<p>인덱스 정상 수집 확인</p>

<hr />

<h2 id="reference">Reference</h2>

<ol>
  <li><a href="https://www.elastic.co/guide/en/apm/agent/index.html">APM Agents</a></li>
  <li><a href="https://www.elastic.co/guide/en/apm/agent/java/current/index.html">APM Java Agent Reference</a></li>
  <li><a href="https://www.elastic.co/guide/en/apm/agent/java/current/configuration.html">APM Java Agent Configuration</a></li>
  <li><a href="https://www.elastic.co/guide/en/apm/agent/java/current/setup-attach-cli.html#setup-attach-cli-supported-environments">Automatic setup with <code class="language-plaintext highlighter-rouge">apm-agent-attach-cli.jar</code></a></li>
  <li><a href="https://www.elastic.co/guide/en/apm/agent/java/current/setup-attach-api.html">Programmatic API setup to self-attach</a></li>
  <li><a href="https://m.blog.naver.com/olpaemi/221788820388">엘라스틱서치 APM을 이용해서 쿠버네티스 환경의 자바 어플리케이션 모니터링하기(1)</a></li>
  <li><a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">Init Containers</a></li>
</ol>


    
  </section>

  <!-- Social media shares -->
  


   <!-- Tag list -->
  
  


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="/tags#APM">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> APM</p>
        </a></li>
      
        <li><a class="button" href="/tags#ArgoCD">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> ArgoCD</p>
        </a></li>
      
        <li><a class="button" href="/tags#ELK">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> ELK</p>
        </a></li>
      
        <li><a class="button" href="/tags#Elastic">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Elastic</p>
        </a></li>
      
        <li><a class="button" href="/tags#Elasticsearch">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Elasticsearch</p>
        </a></li>
      
        <li><a class="button" href="/tags#GitOps">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> GitOps</p>
        </a></li>
      
        <li><a class="button" href="/tags#Helm">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Helm</p>
        </a></li>
      
        <li><a class="button" href="/tags#JVM">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> JVM</p>
        </a></li>
      
        <li><a class="button" href="/tags#Java">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Java</p>
        </a></li>
      
    </ul>
  </div>



</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <div id="previous-post">
        <a alt="Elastic Metricbeat 설치 및 설정" href="/2021/07/27/elastic-metricbeat-install.html">
            <p>Previous post</p>
            Elastic Metricbeat 설치 및 설정
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="PostgreSQL 백업 및 복구 방법" href="/2021/07/22/postgresql-backup-restore.html">
            <p>Next post</p>
            PostgreSQL 백업 및 복구 방법
        </a>
    </div>
    
</div>



<!--Utterances-->
 <script src="https://utteranc.es/client.js"
        repo='csupreme19/csupreme19.github.io'
        issue-term="comment"
        theme="preferred-color-scheme"
		
        crossorigin="anonymous"
        async>
</script>
 

<!-- Cusdis -->


<!-- Disqus -->


<!-- To change color of links in the page -->
<style>
  header#main {
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
  }
  
  
  
  
  header#main { background-image: url('/assets/img/titles/elastic-logo.png'); }
  
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                


    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="https://github.com/csupreme19"
               title="Follow on Github"
               target="_blank"
               rel="me">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fab fa-github fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    
        
        
        
        
        <li>
            <a href="mailto:csupreme19@gmail.com"
               title="Follow on Mail"
               target="_blank"
               rel="me">
            <span class="fa-stack fa-lg">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
            </a>
        </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


                </ul>
            </div>
</footer>



  </body>
</html>
