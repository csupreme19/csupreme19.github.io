<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-11-29T13:49:00+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Seunghoon Choi</title><subtitle>DevOps 개발 블로그</subtitle><entry><title type="html">Jekyll과 Github pages를 사용하여 블로그 만들기</title><link href="http://localhost:4000/2021/11/18/github-pages-with-jekyll.html" rel="alternate" type="text/html" title="Jekyll과 Github pages를 사용하여 블로그 만들기" /><published>2021-11-18T00:00:00+09:00</published><updated>2021-11-18T00:00:00+09:00</updated><id>http://localhost:4000/2021/11/18/github-pages-with-jekyll</id><content type="html" xml:base="http://localhost:4000/2021/11/18/github-pages-with-jekyll.html">&lt;h1 id=&quot;jekyll과-github-pages를-사용하여-간단하게-블로그를-만들어보자&quot;&gt;Jekyll과 Github pages를 사용하여 간단하게 블로그를 만들어보자&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/github-pages.png&quot; alt=&quot;github-pages.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;본 문서는 현재 보고 있는 블로그를 구현하였던 내용을 담고 있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;시작하게된-계기&quot;&gt;시작하게된 계기&lt;/h2&gt;

&lt;p&gt;문득 개발을 하고 있는데 &lt;strong&gt;왜 남는게 없지?&lt;/strong&gt; 라는 생각이 들기 시작하였다.&lt;/p&gt;

&lt;p&gt;요즘엔 양질의 개발자료를 손가락 몇번 놀리면 쉽게 찾을 수 있다보니 정보를 검증도 하지 않고 여과없이 받아들일 수도 있겠다는 생각이 들었고 정보를 내것으로 만들어야겠다는 필요성이 느껴졌다.&lt;/p&gt;

&lt;p&gt;문서를 작성하면서 헷갈리는 부분도 정리할 수 있고 무엇보다 남들에게 설명하도록 나중에 내가 봐도 이해할 수 있도록 작성하려면 확실한 이해가 바탕이 되어야 하기 때문에 시작하게 되었다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;어떤걸-써야할까&quot;&gt;어떤걸 써야할까&lt;/h2&gt;

&lt;p&gt;웹개발이라는 것은 익숙하지만 결코 간단한 것이 아니다. (자세히 말하면 public하게 오픈하는 것)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;JS, CSS 등의 Frontend 스택을 활용하여 프론트 웹을 개발한다.&lt;/li&gt;
  &lt;li&gt;웹에서 사용할 REST API를 정의 및 개발하고 경우에 따라 DB를 구축한다.&lt;/li&gt;
  &lt;li&gt;Cloud 환경이든 자체 구축 서버든 웹을 빌드하여 올릴 서버가 필요하다.&lt;/li&gt;
  &lt;li&gt;도메인, 인증서 구매 및 적용을 통해 외부에 오픈이 필요하다.&lt;/li&gt;
  &lt;li&gt;추가적으로) 최소한의 보안과 무중단 배포를 위한 proxy 서버가 필요&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;선택기준&quot;&gt;선택기준&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;간단한 기술 블로그를 위하여 웹개발을 하기는 싫었다.&lt;/li&gt;
  &lt;li&gt;자체 서버를 구축하기 싫었다. (비용적으로든 노력으로든)&lt;/li&gt;
  &lt;li&gt;추가적인 비용을 들이기 싫었다.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;따라서 자체 호스팅을 하는 사이트를 이용하는 방법을 선택하였다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;블로그-플랫폼&quot;&gt;블로그 플랫폼&lt;/h2&gt;

&lt;p&gt;조사 결과 여러가지 블로그 플랫폼 서비스들이 존재하였다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://velog.io/&quot;&gt;https://velog.io&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;개발자를 위한 블로그 서비스(플랫폼)&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;마크다운 작성 가능&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://wordpress.org/&quot;&gt;https://wordpress.org&lt;/a&gt;&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;전세계적으로 가장 유명한 블로그 서비스&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;커스터마이징 기능이 강력&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;방대한 생태계&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.tistory.com/&quot;&gt;https://www.tistory.com&lt;/a&gt;&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;유명한 블로그 플랫폼&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;WYSIWYG 방식의 에디터를 제공&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;특정 환경에서 접속이 매우 느림&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://blog.naver.com&quot;&gt;https://blog.naver.com&lt;/a&gt;&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;유명한 블로그 플랫폼2&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;WYSIWYG 방식의 에디터를 제공&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;구글 검색이 안되는 치명적인 단점이 있음&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;개발 한정으로 매우 기능이 부실&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://pages.github.com/&quot;&gt;https://pages.github.com&lt;/a&gt;&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;github과 연동됨&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;markdown 지원&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;퍼블릭 도메인 간편하게 설정 가능&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;결론은&quot;&gt;결론은?&lt;/h3&gt;

&lt;p&gt;웹 개발에 공을 들이기는 싫었고 현재 마크다운으로 작성되어 있는 문서들을 쉽게 올릴 수 있어야 하였고 github과 연동되는 Github pages를 사용하기로 하였다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;jekyll&quot;&gt;Jekyll&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/jekyll.png&quot; alt=&quot;jekyll.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jekyllrb.com/&quot;&gt;https://jekyllrb.com/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;GitHub 공동 설립자 Tom Preston-Werner에 의해 개발된 Ruby 기반의 정적 사이트 생성기(Static site generator)이다.&lt;/p&gt;

&lt;p&gt;여기서 SSG(Static Site Generator)란 DB없이 static file 즉 html만으로 돌아가는 웹을 의미한다.&lt;/p&gt;

&lt;p&gt;마크다운 형태로 작성이 가능하여 개발자 freindly하며 구현도 매우 간편하게 할 수 있다.&lt;/p&gt;

&lt;p&gt;Github pages와 궁합이 매우 좋으며 Github pages 공식 문서에서도 Jekyll을 이용하도록 안내하고 있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;github-pages&quot;&gt;Github pages&lt;/h2&gt;

&lt;h3 id=&quot;1-저장소-생성&quot;&gt;1. 저장소 생성&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/gpwj-1.png&quot; alt=&quot;gpwj-1.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Github pages는 계정의 github repository를 기반으로 웹을 제공한다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{사용자명}.github.io&lt;/code&gt; 의 형태로 저장소를 생성하면 해당 저장소는 자동으로 github pages 저장소로 설정이 된다.&lt;/p&gt;

&lt;p&gt;(올바른 branch에 커밋시 자동으로 github pages를 빌드하도록 설정이 되어있다.)&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;사진은 이미 저장소를 만들었기 때문에 중복되었다고 나옴&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;2-git-설정&quot;&gt;2. git 설정&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 유저명은 csupreme19로 가정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; ~/git/csupreme19.github.io
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/git/csupreme19.github.io
&lt;span class=&quot;c&quot;&gt;# git 사용자 설정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config &lt;span class=&quot;nt&quot;&gt;--local&lt;/span&gt; user.name csupreme19
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config &lt;span class=&quot;nt&quot;&gt;--local&lt;/span&gt; user.email csupreme19@gmail.com

&lt;span class=&quot;c&quot;&gt;# git 로컬 저장소 초기화&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git init

&lt;span class=&quot;c&quot;&gt;# git remote 저장소 연결&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git remote add origin git@github.com:csupreme19/csupreme19.github.io.git
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git remote &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
origin	git@github.com:csupreme19/csupreme19.github.io.git &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;fetch&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
origin	git@github.com:csupreme19/csupreme19.github.io.git &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;push&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;나는 사내 gitlab의 계정이 global로 설정되어 있어 해당 git 저장소에만 config를 적용하도록 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--local&lt;/code&gt; flag를 사용하였다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;3-테마-설정&quot;&gt;3. 테마 설정&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;http://jekyllthemes.org/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;위 사이트에서 마음에 드는 테마를 선택 후 github에서 fork 또는 clone한다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;jekyll을 설치 하는 것이 원래 해야 할 일이지만 보통 테마에서 jekyll gemspec 명세를 제공하므로 jekyll 설치를 뒤로하고 테마 설정을 진행한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/type-on-strap.png&quot; alt=&quot;type-on-strap.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;본인은 &lt;a href=&quot;http://jekyllthemes.org/themes/Type-on-Strap/&quot;&gt;Type on Strap&lt;/a&gt; 테마를 선택하였다.&lt;/p&gt;

&lt;h4 id=&quot;선택-이유&quot;&gt;선택 이유?&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;현재까지도 유지보수가 되고 있는 점(선택 시점에 10시간 전에 릴리즈된 것을 확인)&lt;/li&gt;
  &lt;li&gt;컨텐츠 중심의 가독성 좋은 테마&lt;/li&gt;
  &lt;li&gt;반응형 웹&lt;/li&gt;
  &lt;li&gt;다크 테마 지원&lt;/li&gt;
  &lt;li&gt;mermaid, katex 등 다이어그램, 수식 툴 지원&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;단점이라면 한글 폰트가 생각보다 크게 보인다는 것인데… 이후 폰트 및 사이즈 변경 예정이다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;jekyll-설치-및-설정&quot;&gt;Jekyll 설치 및 설정&lt;/h2&gt;

&lt;h3 id=&quot;선행사항&quot;&gt;선행사항&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Ruby 2.5.0 이상&lt;/li&gt;
  &lt;li&gt;RubyGems&lt;/li&gt;
  &lt;li&gt;GCC&lt;/li&gt;
  &lt;li&gt;Make&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;1-ruby-설치macos&quot;&gt;1. Ruby 설치(macOS)&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Homebrew 설치&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/bin/bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-fsSL&lt;/span&gt; https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Ruby 설치&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;brew &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;ruby
&lt;span class=&quot;c&quot;&gt;# zsh 사용시&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;export PATH=&quot;/usr/local/opt/ruby/bin:/usr/local/lib/ruby/gems/3.0.0/bin:$PATH&quot;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; ~/.zshrc
&lt;span class=&quot;c&quot;&gt;# bash 사용시&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;export PATH=&quot;/usr/local/opt/ruby/bin:/usr/local/lib/ruby/gems/3.0.0/bin:$PATH&quot;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; ~/.bash_profile

&lt;span class=&quot;c&quot;&gt;# 버전 확인&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ruby &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gem &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;다른 OS 설치 방법은 &lt;a href=&quot;https://jekyllrb.com/docs/installation/&quot;&gt;Jekyll 설치 문서&lt;/a&gt; 참조&lt;/p&gt;

&lt;h3 id=&quot;2-jekyll-및-테마-설치&quot;&gt;2. Jekyll 및 테마 설치&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/git/csupreme19.github.io
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/Sylhare/Type-on-Strap.git

&lt;span class=&quot;c&quot;&gt;# install&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gem &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;jekyll
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bundle add webrick
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bundle &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# jekyll 로컬 서버 실행&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bundle &lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;jekyll serve
Configuration file: /Users/csupreme19/git/csupreme19.github.io/_config.yml
            Source: /Users/csupreme19/git/csupreme19.github.io
       Destination: /Users/csupreme19/git/csupreme19.github.io/_site
 Incremental build: disabled. Enable with &lt;span class=&quot;nt&quot;&gt;--incremental&lt;/span&gt;
      Generating...
       Jekyll Feed: Generating feed &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;posts
                    &lt;span class=&quot;k&quot;&gt;done in &lt;/span&gt;1.461 seconds.
 Auto-regeneration: enabled &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/Users/csupreme19/git/csupreme19.github.io&apos;&lt;/span&gt;
    Server address: http://127.0.0.1:4000/
  Server running... press ctrl-c to stop.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-_configyml-수정&quot;&gt;3. _config.yml 수정&lt;/h3&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# SITE CONFIGURATION&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;baseurl&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;		&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# 설정한 url이 subdomain이 된다. 즉 {url}/{baseurl} 도메인으로 접속해야함&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://csupreme19.github.io&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;		&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# 도메인 주소 설정&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# THEME-SPECIFIC CONFIGURATION&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;내 블로그&lt;/span&gt;                             &lt;span class=&quot;c1&quot;&gt;# 타이틀&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;한글테스트&quot;&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;# 구글 검색 엔진에서 사용하는 정보&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;avatar&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;assets/img/triangle.png&lt;/span&gt;                         &lt;span class=&quot;c1&quot;&gt;# 상단 navbar 이미지&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;favicon&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;assets/favicon.ico&lt;/span&gt;                             &lt;span class=&quot;c1&quot;&gt;# 웹 favicon&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Header and footer text&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;header_text&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;헤더 텍스트&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# 블로그 헤더 텍스트&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;header_feature_image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;assets/img/pexels/triangular.jpeg&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 헤더 이미지&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# 푸터 텍스트&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;footer_text&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;Powered by &amp;lt;a href=&quot;https://jekyllrb.com/&quot;&amp;gt;Jekyll&amp;lt;/a&amp;gt; with &amp;lt;a href=&quot;https://github.com/sylhare/Type-on-Strap&quot;&amp;gt;Type on Strap&amp;lt;/a&amp;gt;&lt;/span&gt;
  
&lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# 나머지 설정은 github 문서 참조&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-로컬-접속-테스트&quot;&gt;4. 로컬 접속 테스트&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/gpwj-2.png&quot; alt=&quot;gpwj-2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;http://localhost:4000 접속 확인&lt;/p&gt;

&lt;h3 id=&quot;5-git-push-및-github-pages-설정&quot;&gt;5. git push 및 github pages 설정&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git add &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git commit &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;initial commit&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git push &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; origin main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/gpwj-3.png&quot; alt=&quot;gpwj-3.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;github 저장소 &amp;gt; Settings &amp;gt; Pages&lt;/p&gt;

&lt;h4 id=&quot;빌드-소스-변경&quot;&gt;빌드 소스 변경&lt;/h4&gt;

&lt;p&gt;Source 부분 main 브랜치, / (root) 폴더로 변경&lt;/p&gt;

&lt;p&gt;변경 후 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Your site is published at https://csupreme19.github.io/&lt;/code&gt; 빌드 성공 메시지 확인&lt;/p&gt;

&lt;h3 id=&quot;6-접속&quot;&gt;6. 접속&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://csupreme19.github.io/&quot;&gt;https://csupreme19.github.io/&lt;/a&gt; 접속 확인&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;댓글창-활성화&quot;&gt;댓글창 활성화&lt;/h2&gt;

&lt;p&gt;Type-on-Strap 테마는 3가지의 Comment 오픈소스를 지원한다.&lt;/p&gt;

&lt;h3 id=&quot;1-disqus&quot;&gt;1. Disqus&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://disqus.com/&quot;&gt;disqus.com&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;장점&quot;&gt;장점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;로그인 안해도 댓글 달 수 있음&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;단점&quot;&gt;단점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;무겁다, 무료버전은 광고가 존재&lt;/li&gt;
  &lt;li&gt;개인적인 의견이지만 댓글창이 너저분해보인다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-cusdis&quot;&gt;2. Cusdis&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://cusdis.com/&quot;&gt;cusdis.com&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;장점-1&quot;&gt;장점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Disqus에 비해 매우 깔끔한 레이아웃&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;단점-1&quot;&gt;단점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;중국발이라 왠지 모를 거부감&lt;/li&gt;
  &lt;li&gt;disqus와 마찬가지로 무겁다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-utterance&quot;&gt;3. Utterance&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://utteranc.es/&quot;&gt;utterance.es&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;장점-2&quot;&gt;장점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;매우 깔끔한 레이아웃&lt;/li&gt;
  &lt;li&gt;성능이 위 2 오픈소스에 비해 좋다.&lt;/li&gt;
  &lt;li&gt;완전 무료 오픈소스로 광고 없음&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;단점-2&quot;&gt;단점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;댓글이 repo에 GitHub 이슈로 등록되는 구조라 GitHub 계정이 있어야만 댓글 가능&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Utterance를 사용하기로 하였다.&lt;/p&gt;

&lt;p&gt;일반적인 블로그가 아니라 GitHub Pages로 운영되는 GitHub 기반 블로그이며 주로 개발 내용을 다루기 때문에 GitHub 계정이 필요한 것은 큰 단점으로 다가오지 않았다.&lt;/p&gt;

&lt;p&gt;또한 GitHub Issue로 등록되므로 Webhook을 등록하여 Slack 알람을 받는등 Alert 기능도 활성화 가능하다고 생각하였다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;utterance-적용하기&quot;&gt;Utterance 적용하기&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/utterance.png&quot; alt=&quot;utterance.png&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;1-public-repo-생성&quot;&gt;1. Public Repo 생성&lt;/h4&gt;

&lt;p&gt;Github pages repo가 public이므로 해당 repo 사용&lt;/p&gt;

&lt;h4 id=&quot;2-utterance-app-설치&quot;&gt;2. Utterance App 설치&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apps/utterances&quot;&gt;https://github.com/apps/utterances&lt;/a&gt;에서 설치&lt;/p&gt;

&lt;h4 id=&quot;3-_configyml-설정&quot;&gt;3. _config.yml 설정&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Comments&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;utterances&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;repo&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;csupreme19/csupreme19.github.io&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;issue-term&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;comment&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;위 두가지 설정만 하면 설정은 끝난다.&lt;/p&gt;

&lt;h4 id=&quot;4-코멘트-적용-확인&quot;&gt;4. 코멘트 적용 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bundle &lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;jekyll serve
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/gpwj-4.png&quot; alt=&quot;gpwj-4.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;폰트-변경&quot;&gt;폰트 변경&lt;/h2&gt;

&lt;p&gt;맥 환경에서 봤을땐 폰트가 사이즈 말고는 괜찮았는데 윈도우 환경에서 보니 계단 현상이 존재하고 가독성이 떨어져 보이는 문제가 발생하였다.&lt;/p&gt;

&lt;p&gt;테마(템플릿)를 사용하는 이유가 UI 개발에 힘을 쏟기 싫었기 때문인데 어쩔 수 없이 입맛에 맞는 커스텀은 필요한 것 같다.&lt;/p&gt;

&lt;h3 id=&quot;1-폰트-scss-파일-생성&quot;&gt;1. 폰트 .scss 파일 생성&lt;/h3&gt;

&lt;p&gt;일반 폰트는 케이티의 &lt;a href=&quot;https://noonnu.cc/font_page/500&quot;&gt;Y 너만을 비춤체&lt;/a&gt;, 소스 코드 폰트는 네이버의 &lt;a href=&quot;https://github.com/naver/d2codingfont&quot;&gt;D2 coding ligature&lt;/a&gt;를 사용하였다.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;_sass/external
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim _y-spotlight.scss
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim _d2-coding-ligature.scss
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;폰트 배포시 별도의 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@font-face&lt;/code&gt; 소스를 제공한다.&lt;/p&gt;

&lt;p&gt;없다면 기본 구성되어있는 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_source-sans-pro.scss&lt;/code&gt; 파일을 복사하여 사용하자.&lt;/p&gt;

&lt;div class=&quot;language-scss highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// _y-spotlight.scss&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@font-face&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Y_Spotlight&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sx&quot;&gt;url(&apos;https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts-20-12@1.0/Y_Spotlight.woff&apos;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;woff&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-weight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// _d2-coding-ligature.scss&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@font-face&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;D2 coding Ligature&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sx&quot;&gt;url(&apos;https://cdn.jsdelivr.net/gh/everydayminder/assets/subset-D2Codingligature.woff&apos;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;woff&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-weight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;폰트 소스는 cdn을 사용하였는데 D2 coding 폰트의 경우 공식으로 CDN을 제공하고 있지 않는 것 같다.&lt;/p&gt;

&lt;p&gt;따라서 &lt;a href=&quot;https://luran.me/515&quot;&gt;everyminder&lt;/a&gt; 에서 제공한 woff CDN을 사용하였다.&lt;/p&gt;

&lt;h3 id=&quot;2-_variablesscss-수정&quot;&gt;2. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_variables.scss&lt;/code&gt; 수정&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim _sass/base/_variables.scss
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_variables.scss&lt;/code&gt; 파일에 테마 변수 정보들이 담겨있다.&lt;/p&gt;

&lt;p&gt;아래 부분처럼 위에서 추가했던 font-family를 추가한다.&lt;/p&gt;

&lt;div class=&quot;language-scss highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/* TYPOGRAPHY */&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-family-main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Y_Spotlight&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Source Sans Pro&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Helvetica&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-family-headings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Y_Spotlight&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Source Sans Pro&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Helvetica&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-family-logo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Y_Spotlight&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Source Sans Pro&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Helvetica&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Arial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;.875em&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$monospace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;D2 coding ligature&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Consolas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Menlo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Monaco&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Lucida&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Liberation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DejaVu&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sans&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bitstream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Vera&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sans&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mono&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Courier&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;monospace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sans-serif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-size-code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;.85em&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$font-height-code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;.3em&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$border-radius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4px&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;하는 김에 글씨 크기가 커서 폰트 사이즈도 조정해 주었다.&lt;/p&gt;

&lt;h3 id=&quot;3-확인&quot;&gt;3. 확인&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/gpwj-5.png&quot; alt=&quot;gpwj-5.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;폰트 적용이 된 것을 확인할 수 있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/installation/&quot;&gt;Jekyll Installation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://jekyllthemes.org/&quot;&gt;Jekyll Themes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/Sylhare/Type-on-Strap&quot;&gt;Type-on-Strap&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Blog" /><category term="Github" /><category term="Github pages" /><category term="Jekyll" /><summary type="html">Jekyll과 Github pages를 사용하여 간단하게 블로그를 만들어보자</summary></entry><entry><title type="html">Kubernetes Pod 재시작 장애 확인하기</title><link href="http://localhost:4000/2021/10/14/kubernetes-pod-fail-test.html" rel="alternate" type="text/html" title="Kubernetes Pod 재시작 장애 확인하기" /><published>2021-10-14T00:00:00+09:00</published><updated>2021-10-14T00:00:00+09:00</updated><id>http://localhost:4000/2021/10/14/kubernetes-pod-fail-test</id><content type="html" xml:base="http://localhost:4000/2021/10/14/kubernetes-pod-fail-test.html">&lt;h1 id=&quot;kubernetes-pod-재시작-장애-확인하기&quot;&gt;Kubernetes Pod 재시작 장애 확인하기&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy&quot;&gt;Container restart policy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;강제로 죽는 pod를 배포 후 해당 파드가 어떻게 restart 되는지 살펴보았다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;실험&quot;&gt;실험&lt;/h2&gt;

&lt;h3 id=&quot;실험-절차&quot;&gt;실험 절차&lt;/h3&gt;

&lt;h4 id=&quot;1-pod-배포&quot;&gt;1. Pod 배포&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# alias k=kubectl&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Declarative way&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;$ vim dummy-pod.yaml&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Pod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dummy-pod&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dummy-pod&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Always&lt;/span&gt;
  
&lt;span class=&quot;s&quot;&gt;$ k create -f dummy-pod.yaml&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;pod/dummy-pod created&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Imperative way&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;$ k run dummy-pod --image ubuntu&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;pod/dummy-pod created&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;2-pod-상태-확인&quot;&gt;2. Pod 상태 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS              RESTARTS   AGE
dummy-pod                  0/1     ContainerCreating   0          2s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS      RESTARTS   AGE
dummy-pod                  0/1     Completed   1          10s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS      RESTARTS   AGE
dummy-pod                  0/1     Completed   2          32s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS      RESTARTS   AGE
dummy-pod                  0/1     Completed   3          61s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS      RESTARTS   AGE
dummy-pod                  0/1     Completed   4          118s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS             RESTARTS   AGE
dummy-pod                  0/1     CrashLoopBackOff   4          2m34s

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;k get po
NAME                       READY   STATUS      RESTARTS   AGE
dummy-pod                  0/1     Completed   5          3m33s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;10, 30, 60, 110, 210초에 각각 restart되는 것으로 확인&lt;/p&gt;

&lt;p&gt;공식 문서에 따르면 지수 백오프 지연(10초, 20초, 40초, …)로 10초로 시작하여 2배씩 재시작 간격이 증가한다고 함(최대 300초(5분))&lt;/p&gt;

&lt;p&gt;지수배는 아니지만 비슷하게 재시작 된 것을 확인할 수 있었다.&lt;/p&gt;

&lt;h4 id=&quot;3-결론&quot;&gt;3. 결론&lt;/h4&gt;

&lt;p&gt;아래와 같이 다양한 기준을 적용하여 파드가 계속 재시작중인지 restart 횟수 만으로 판별 가능&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;파드 배포 후 1분 내 2번 이상(10, 30, 60초)&lt;/li&gt;
  &lt;li&gt;파드 배포 후 3분 내 4번 이상(10, 30, 60, 110, 210초)&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy&quot;&gt;Container restart policy&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Kubernetes" /><category term="K8S" /><category term="Pod" /><category term="Fail" /><summary type="html">Kubernetes Pod 재시작 장애 확인하기</summary></entry><entry><title type="html">Kubernetes RBAC Authorization 개요 및 적용</title><link href="http://localhost:4000/2021/10/01/kubernetes-RBAC-auth.html" rel="alternate" type="text/html" title="Kubernetes RBAC Authorization 개요 및 적용" /><published>2021-10-01T00:00:00+09:00</published><updated>2021-10-01T00:00:00+09:00</updated><id>http://localhost:4000/2021/10/01/kubernetes-RBAC-auth</id><content type="html" xml:base="http://localhost:4000/2021/10/01/kubernetes-RBAC-auth.html">&lt;h1 id=&quot;kubernetes-rbac-authorization-개요-및-적용&quot;&gt;Kubernetes RBAC Authorization 개요 및 적용&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/kubernetes-logo.png&quot; alt=&quot;kubernetes-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/rbac/&quot;&gt;Using RBAC Authorization&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;본 문서에서는 쿠버네티스 API 서버에 접근하기 위한 4가지 인증 방식을 살펴보고 그 중 RBAC 인증 적용방법에 대하여 정리하였다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;인가authentication-vs-인증authorization&quot;&gt;인가(Authentication) vs 인증(Authorization)&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/authorization-authentication.jpeg&quot; alt=&quot;authorization-authentication.jpeg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;인가(Authentication)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;해당 사용자가 누구인지 확인하는 것(회원가입, 로그인)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;인증(Authorization)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;해당 사용자에 대한 권한을 허락하는 것(호, 자원 접근)&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;kubernetes-인증-방식&quot;&gt;Kubernetes 인증 방식&lt;/h2&gt;

&lt;p&gt;Kubernetes API 서버에 접근하기 위해서는 인증 단계가 필요하다.&lt;/p&gt;

&lt;p&gt;쿠버네티스에서는 인증 방식이 크게 4가지가 존재한다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Node Authorization&lt;/li&gt;
  &lt;li&gt;ABAC Authorization&lt;/li&gt;
  &lt;li&gt;RBAC Authorization&lt;/li&gt;
  &lt;li&gt;Webhook Authorization&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;API Server의 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--authorization-mode&lt;/code&gt;  flag를 확인하여 현재 활성화된 인증 모드를 확인할 수 있다.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/kubernetes/manifests/kube-apiserver.yaml | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; authorization
    - &lt;span class=&quot;nt&quot;&gt;--authorization-mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Node,RBAC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;기본적으로 Node, RBAC 인증 방식이 활성화되어 있는 것을 확인할 수 있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;node-authorization&quot;&gt;Node Authorization&lt;/h3&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User]
  B[Kube API]
  C[&quot;Kubelet&lt;br /&gt;Node&quot;]
  subgraph Kubernetes Cluster
    C--Node Authorization--&amp;gt;B
  end
    A--&amp;gt;B
&lt;/div&gt;

&lt;p&gt;Kubernetes Clsuter에 속하는 Node들은 Kubelet에서 API 서버에 요청할 때 TLS 인증을 이용한다.&lt;/p&gt;

&lt;p&gt;이 때 Kubelet의 Group은 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system:node&lt;/code&gt;에 속해 있으며 해당 그룹에 속해있는 인증 요청은 Node Authorizer에 의하여 인증된다.&lt;/p&gt;

&lt;p&gt;이 방식은 보통 Kubernetes TLS 부트스트랩 과정에서 자동으로 설정되므로 더 자세한 내용은 &lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/node/&quot;&gt;공식 문서&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;abacattribute-based-access-control&quot;&gt;ABAC(Attribute Based Access Control)&lt;/h3&gt;

&lt;p&gt;JSON 형식의 Policy 정의를 사용하여 해당 사용자를 인증하는 방식&lt;/p&gt;

&lt;h5 id=&quot;examples&quot;&gt;Examples&lt;/h5&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User: admin]
  B[Group: system:authenticated]
  C[Kube API]
  subgraph Kuberntes Cluster
  A--ABAC--&amp;gt;C
  B--ABAC--&amp;gt;C
  end
&lt;/div&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;abac.authorization.kubernetes.io/v1beta1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Policy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;spec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;namespace&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;              &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;resource&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;         &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;apiGroup&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;abac.authorization.kubernetes.io/v1beta1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Policy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;spec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;group&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;system:authenticated&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;nonResourcePath&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;readonly&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;기본적으로 비활성화 되어 있으며 kube-apiserver에 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--authorization-mode=ABAC&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--authorization-policy-file=파일명&lt;/code&gt; 설정을 추가하여야 한다.&lt;/p&gt;

&lt;p&gt;Poilicy 정의 후 API 서버를 재시작해야하고 접근권한을 파일로 정의하기 때문에 후술할 RBAC에 비하여 관리하기가 어렵다는 단점이 있다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;rbacrole-based-access-control&quot;&gt;RBAC(Role Based Access Control)&lt;/h3&gt;

&lt;p&gt;사용자, 서비스의 접근 권한(인증)을 Role(ClusterRole)과 RoleBinding(ClusterRoleBinding) 자원에 기반하여 처리하는 방식으로 일반적으로 가장 많이 사용하고 관리하기 쉬운 인증 방식이다.&lt;/p&gt;

&lt;p&gt;해당 User, SA(Service Account), Group등이 RoleBinding에 의하여 어떤 접근권한을 가지고 있는지 인증된다.&lt;/p&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User]
  B[Group]
    subgraph Kubernetes Cluster
    C[Service Account]
  D[Role: Developer]
  E[Role: Production]
  end
  A--RBAC--&amp;gt;D &amp;amp; E
  B--RBAC--&amp;gt;D
  C--RBAC--&amp;gt;E
&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;webhook-authorization&quot;&gt;Webhook Authorization&lt;/h3&gt;

&lt;p&gt;Kubernetes 내부에서 제공하는 인증이 아닌 외부의 인증 정책을 사용하기 위한 방식&lt;/p&gt;

&lt;p&gt;Open Policy Agent와 같은 외부 오픈소스, Admission Controller를 사용할 때 사용한다.&lt;/p&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User]
    subgraph Kubernetes Cluster
  B[Kube API]
    end
  C[Open Policy Agent]
  A--&amp;gt;B
  B--Authorization--&amp;gt;C
  C-.Authorization.-&amp;gt;B
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;rbac-리소스&quot;&gt;RBAC 리소스&lt;/h2&gt;

&lt;h3 id=&quot;1-role--clusterrole&quot;&gt;1. Role / ClusterRole&lt;/h3&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[Role&lt;br /&gt;Can view Pods&lt;br /&gt;Can watch Pods&lt;br /&gt;Can list Pods]
  A
&lt;/div&gt;

&lt;p&gt;어떤 리소스에 어떤 호출이 가능한지 권한/역할을 정의한 리소스이다.&lt;/p&gt;

&lt;p&gt;Role과 ClusterRole이 있으며 ClusterRole은 Role과 달리 클러스터 레벨로 가지고 있어 네임스페이스가 존재하지 않는다.&lt;/p&gt;

&lt;h4 id=&quot;role-예제&quot;&gt;Role 예제&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;pod-reader&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# &quot;&quot; indicates the core API group&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;watch&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# &quot;namespace&quot; omitted since ClusterRoles are not namespaced&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;secret-reader&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;secrets&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;watch&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resources에 해당하는 자원의 verb에 해당하는 요청이 가능하다.&lt;/p&gt;

&lt;p&gt;pod-reader를 예로 들면 pods를 get, watch, list 요청이 가능하다.&lt;/p&gt;

&lt;p&gt;kubernetes의 자원 종류는 아래 명령어로 확인 가능하다.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl api-resources
NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
bindings                                       v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;Binding
componentstatuses                 cs           v1                                     &lt;span class=&quot;nb&quot;&gt;false        &lt;/span&gt;ComponentStatus
configmaps                        cm           v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;ConfigMap
endpoints                         ep           v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;Endpoints
events                            ev           v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;Event
limitranges                       limits       v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;LimitRange
namespaces                        ns           v1                                     &lt;span class=&quot;nb&quot;&gt;false        &lt;/span&gt;Namespace
nodes                             no           v1                                     &lt;span class=&quot;nb&quot;&gt;false        &lt;/span&gt;Node
persistentvolumeclaims            pvc          v1                                     &lt;span class=&quot;nb&quot;&gt;true         &lt;/span&gt;PersistentVolumeClaim
persistentvolumes                 pv           v1                                     &lt;span class=&quot;nb&quot;&gt;false        &lt;/span&gt;PersistentVolume
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;role-확인&quot;&gt;Role 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get role &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kube-system
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get clusterrole &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe role/kube-proxy &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kube-system
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe clusterrole/cluster-admin
Name:         cluster-admin
Labels:       kubernetes.io/bootstrapping&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: &lt;span class=&quot;nb&quot;&gt;true
&lt;/span&gt;PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  &lt;span class=&quot;nt&quot;&gt;---------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                 &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-serviceaccount&quot;&gt;2. ServiceAccount&lt;/h3&gt;

&lt;p&gt;파드로 올라가있는 서비스에서 kubernetes 클러스터에 접근하기 위한 계정을 나타내는 리소스다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/kra-1.png&quot; alt=&quot;kra-1.png&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;이미지: &lt;a href=&quot;https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/&quot;&gt;Certified Kubernetes Administrator(CKA) with Practice Tests&lt;/a&gt; 발췌&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;쉽게 말해 사용자 계정이 아닌 서비스의 계정이다.&lt;/p&gt;

&lt;p&gt;후술할 추상적인 User, Group과 달리 Kubernetes 자원 형태로 실존한다.&lt;/p&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[Service Account]
  B[Secret]
  A-.token.-B
&lt;/div&gt;

&lt;h4 id=&quot;sa-예제&quot;&gt;SA 예제&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-dashboard&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;sa-확인&quot;&gt;SA 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get sa &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kube-system
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;service account 생성시 해당 서비스 어카운트의 토큰을 가지고 있는 secret이 자동 생성된다.&lt;/p&gt;

&lt;h4 id=&quot;서비스-어카운트-사용방법&quot;&gt;서비스 어카운트 사용방법&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe sa/monitoring-user &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard
Name:                monitoring-user
Namespace:           kubernetes-dashboard
Labels:              &amp;lt;none&amp;gt;
Annotations:         &amp;lt;none&amp;gt;
Image pull secrets:  &amp;lt;none&amp;gt;
Mountable secrets:   monitoring-user-token-r6nss
Tokens:              monitoring-user-token-r6nss
Events:              &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;service account 생성시 해당 서비스 어카운트의 토큰을 가지고 있는 secret이 자동 생성된다.&lt;/p&gt;

&lt;h4 id=&quot;토큰-확인&quot;&gt;토큰 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl describe secret monitoring-user-token-r6nss &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard
Name:         monitoring-user-token-r6nss
Namespace:    kubernetes-dashboard
Labels:       &amp;lt;none&amp;gt;
Annotations:  kubernetes.io/service-account.name: monitoring-user
              kubernetes.io/service-account.uid: cca1bad1-fe4f-430c-978b-52d7f7ea53c5

Type:  kubernetes.io/service-account-token

Data
&lt;span class=&quot;o&quot;&gt;====&lt;/span&gt;
ca.crt:     1066 bytes
namespace:  20 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlVmM2...

&lt;span class=&quot;c&quot;&gt;# 참고) 한번에 토큰 조회&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard get secret &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;kubectl &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard get sa/monitoring-user &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{.secrets[0].name}&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; go-template&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{{.data.token | base64decode}}&quot;&lt;/span&gt;
eyJhbGciOiJSUzI1NiIsImtpZCI6IlVmM2...

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;API 호출시 Authorization 헤더에 해당 토큰을 넣어서 요청하면 인증을 할 수 있다.&lt;/p&gt;

&lt;h4 id=&quot;자원에-적용&quot;&gt;자원에 적용&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dashboard-metrics-scraper&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetesui/metrics-scraper:v1.0.6&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;# 해당 부분 추가&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pod 명세 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serviceAccountName&lt;/code&gt; 에 위에서 생성한 SA 추가하면 해당 Pod는 API Server에 정의된 권한을 가지고 접근할 수 있다.&lt;/p&gt;

&lt;h4 id=&quot;요청-예시&quot;&gt;요청 예시&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 직접 호출시 토큰 명시&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Authorization: Bearer eyJhbGciOiJSUzI1...&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ivk&lt;/span&gt; https://10.213.196.211:6443 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-rolebinding&quot;&gt;3. RoleBinding&lt;/h3&gt;

&lt;p&gt;위에서 생성한 ServiceAccount가 실질적으로 권한을 가지려면 해당 어카운트가 어느 자원에 접근할 수 있는지 허락하는 단계가 필요하다.&lt;/p&gt;

&lt;p&gt;이것을 인증(Authorization)이라고 한다.&lt;/p&gt;

&lt;p&gt;kubernetes에서는 RBAC, 즉 Role 역할을 기반으로하여 인증을 하기 때문에 Role을 ServiceAccount / User / Group에 바인딩하는 방법을 사용하며 이를 나타내기 위한 리소스가 RoleBinding이다.&lt;/p&gt;

&lt;p&gt;RoleBinding과 ClusterRoleBinding이 있으며 ClusterRole의 경우 ClusterRoleBinding을 이용한다.&lt;/p&gt;

&lt;p&gt;각각의 Role은 ServiceAccount, User, Group에 바인딩 될 수 있다.&lt;/p&gt;

&lt;h4 id=&quot;user--group&quot;&gt;&lt;strong&gt;User / Group&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;ServiceAccount와 달리 Kubernetes API server의 User와 Group은 별도로 정의된 Kubernetes Resource가 아니다.&lt;/p&gt;

&lt;p&gt;API server에 접근하기 위한 아래와 같은 보안 설정 파일에 정의되어 있는 User와 Group이라는 추상적인 개념이다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Static Password file&lt;/li&gt;
  &lt;li&gt;Static Token file&lt;/li&gt;
  &lt;li&gt;Certificates&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;보통은 인증서 설정에 User와 Group 정보가 정의되어 있으며 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system:&lt;/code&gt;  으로 시작하는 그룹은 미리 정의된 그룹이다.&lt;/p&gt;

&lt;p&gt;User 정보는 kubeconfig에서 확인할 수 있다.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl config view
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;clusters&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate-authority-data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;DATA+OMITTED&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;https://10.213.196.211:6443&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;contexts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-admin&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-admin@kubernetes&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;current-context&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-admin@kubernetes&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Config&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;preferences&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-admin&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;client-certificate-data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;REDACTED&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;client-key-data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;REDACTED&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User]
  B[Group]
  C[Service Account]
  D[Role]
  E[Secret]
  subgraph RoleBinding
  A &amp;amp; B &amp;amp; C---D
  end
  C -.token.- E
&lt;/div&gt;

&lt;h4 id=&quot;rolebinding-예제&quot;&gt;RoleBinding 예제&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;read-pods&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;default&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;User&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;jane&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Role&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;pod-reader&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cluster-monitoring&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-dashboard&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;ClusterRoleBinding 역시 클러스터 레벨이므로 네임스페이스가 따로 없음&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;rolebinding-확인&quot;&gt;RoleBinding 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get rolebinding
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get clusterrolebinding
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl get pods &lt;span class=&quot;nt&quot;&gt;--as&lt;/span&gt; jane	&lt;span class=&quot;c&quot;&gt;# User 권한 확인&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;rbac-사용-예시&quot;&gt;RBAC 사용 예시&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;시나리오: k8s dashboard에 접근하기 위한 모니터링 인증을 생성한다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;1-kubernetes-dashboard-rbacyaml-작성&quot;&gt;1. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kubernetes-dashboard-rbac.yaml&lt;/code&gt; 작성&lt;/h4&gt;

&lt;p&gt;ServiceAccount, ClusterRole, ClusterRoleBinding을 설정한다.&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-dashboard&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cluster-monitoring&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;namespaces&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;deployments&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;replicasets&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pods/log&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;list&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;watch&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRoleBinding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cluster-monitoring&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ServiceAccount&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;monitoring-user&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kubernetes-dashboard&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cluster의 자원이 아닌 헬스체크등 URI로 API를 호출해야하는 경우 아래와 같이 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resources&lt;/code&gt; 대신 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nonResourceURLs&lt;/code&gt;를 사용한다.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ClusterRole&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;cluster-monitoring&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;nonResourceURLs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/healthz*&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/livez*&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/readyz*&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/version*&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;해당 ClusterRole을 가진 SA의 시크릿 토큰을 이용하여 위 URL에 해당하는 API를 호출할 수 있다.&lt;/p&gt;

&lt;h4 id=&quot;2-token-확인&quot;&gt;2. Token 확인&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;kubectl &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard get secret &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;kubectl &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; kubernetes-dashboard get sa/monitoring-user &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{.secrets[0].name}&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; go-template&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{{.data.token | base64decode}}&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;3-kubernetes-클러스터-접근-테스트&quot;&gt;3. Kubernetes 클러스터 접근 테스트&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Authorization: Bearer eyJhbGciOiJSUzI1...&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; https://10.213.196.211:6443/livez&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;verbose
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]ping ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]log ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]etcd ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/start-kube-apiserver-admission-initializer ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/generic-apiserver-start-informers ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/priority-and-fairness-config-consumer ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/priority-and-fairness-filter ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/start-apiextensions-informers ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/start-apiextensions-controllers ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/crd-informer-synced ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/bootstrap-controller ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/rbac/bootstrap-roles ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/scheduling/bootstrap-system-priority-classes ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/priority-and-fairness-config-producer ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/start-cluster-authentication-info-controller ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/aggregator-reload-proxy-client-cert ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/start-kube-aggregator-informers ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/apiservice-registration-controller ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/apiservice-status-available-controller ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/kube-apiserver-autoregistration ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]autoregister-completion ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+]poststarthook/apiservice-openapi-controller ok
livez check passed

&lt;span class=&quot;c&quot;&gt;# 참고) 실패시&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Status&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Failure&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Unauthorized&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;reason&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Unauthorized&quot;&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;code&quot;&lt;/span&gt;: 401
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;요약&quot;&gt;요약&lt;/h2&gt;

&lt;p&gt;Kubernetes API 서버에 접근하기 위한 인증방식은 크게 4가지가 있다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Node&lt;/li&gt;
  &lt;li&gt;ABAC&lt;/li&gt;
  &lt;li&gt;RBAC&lt;/li&gt;
  &lt;li&gt;Webhook&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;일반적으로 사용하는 인증 방식으로는 RBAC가 있으며 Role에 기반하여 인증하는 방식이다.&lt;/p&gt;

&lt;p&gt;전체적인 구조를 보자면 아래와 같다. (ClusterRole도 동일)&lt;/p&gt;

&lt;div class=&quot;mermaid&quot;&gt;
flowchart LR
  A[User]
  B[Group]
  C[Service Account]
  D[Role]
  subgraph Kubernetes Cluster
  E[Secret]
  J[Pod]
  F[Kube API]
  RoleBinding
  end
  subgraph RoleBinding
  A &amp;amp; B &amp;amp; C---D
  end
  C -.token.- E
  C --&amp;gt; J
  J --Request--&amp;gt; F
  F -.Response.-&amp;gt; J
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/rbac/&quot;&gt;Using RBAC Authorization&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/node/&quot;&gt;Using Node Authorization&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/node/&quot;&gt;Using ABAC Authorization&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/&quot;&gt;Certified Kubernetes Administrator(CKA) with Practice Tests&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Kubernetes" /><category term="K8S" /><category term="Authorization" /><category term="Authentication" /><category term="RBAC" /><category term="ABAC" /><category term="Security" /><summary type="html">Kubernetes RBAC Authorization 개요 및 적용</summary></entry><entry><title type="html">Apt 자동 업그레이드 비활성화(Unattended upgrade)</title><link href="http://localhost:4000/2021/09/09/unattended-upgrade.html" rel="alternate" type="text/html" title="Apt 자동 업그레이드 비활성화(Unattended upgrade)" /><published>2021-09-09T00:00:00+09:00</published><updated>2021-09-09T00:00:00+09:00</updated><id>http://localhost:4000/2021/09/09/unattended-upgrade</id><content type="html" xml:base="http://localhost:4000/2021/09/09/unattended-upgrade.html">&lt;h1 id=&quot;apt-자동-업그레이드-비활성화unattended-upgrade&quot;&gt;Apt 자동 업그레이드 비활성화(Unattended upgrade)&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/ubuntu-logo.svg&quot; alt=&quot;ubuntu-logo.svg&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;개요&quot;&gt;개요&lt;/h2&gt;

&lt;p&gt;Ubuntu 16, 18, 20에서는 기본적으로 Apt 패키지의 Unattended upgrade라는 자동 업데이트 타이머가 활성화 되어 있다. (크론잡 형태)&lt;/p&gt;

&lt;p&gt;리눅스 커널, SSH, OpenSSL 등의 보안 패치를 위하여 자동으로  업데이트를 진행하도록 기본 설정되어 있다.&lt;/p&gt;

&lt;p&gt;보안 취약점을 패치한다는 취지에서는 좋지만 Install, Upgrade된 버전을 사용하려면 서버 재시작이 필수이며&lt;/p&gt;

&lt;p&gt;커널 업데이트로 인하여 OS레벨에서의 문제점이나 장애가 발생할 수 있다.&lt;/p&gt;

&lt;p&gt;이런 장애는 파악하기 매우 어려우므로 운영 관점에서는 해당 기능을 비활성화 하는 것이 좋다.&lt;/p&gt;

&lt;h3 id=&quot;apt-로그-확인&quot;&gt;apt 로그 확인&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /var/log/apt
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tail &lt;/span&gt;history.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;apt-daily-비활성화&quot;&gt;apt-daily 비활성화&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl stop apt-daily.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl stop apt-daily-upgrade.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl disable apt-daily.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl disable apt-daily.service
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl disable apt-daily-upgrade.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl disable apt-daily-upgrade.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;unattended-upgrade-비활성화&quot;&gt;unattended-upgrade 비활성화&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim /etc/apt/apt.conf.d/20auto-upgrades
APT::Periodic::Update-Package-Lists &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
APT::Periodic::Download-Upgradeable-Packages &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
APT::Periodic::AutocleanInterval &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
APT::Periodic::Unattended-Upgrade &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;비활성화-확인&quot;&gt;비활성화 확인&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status apt-daily.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status apt-daily.service
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status apt-daily-upgrade.timer
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status apt-daily-upgrade.service
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl list-unit-files | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;apt-daily

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-config dump | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;Update-Package-Lists
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>csupreme19</name></author><category term="Linux" /><category term="OS" /><category term="Ubuntu" /><category term="Package Manager" /><category term="APT" /><category term="Upgrade" /><summary type="html">Apt 자동 업그레이드 비활성화(Unattended upgrade)</summary></entry><entry><title type="html">Elasticsearch ILM 로그 주기 관리</title><link href="http://localhost:4000/2021/08/11/elastic-ilm.html" rel="alternate" type="text/html" title="Elasticsearch ILM 로그 주기 관리" /><published>2021-08-11T00:00:00+09:00</published><updated>2021-08-11T00:00:00+09:00</updated><id>http://localhost:4000/2021/08/11/elastic-ilm</id><content type="html" xml:base="http://localhost:4000/2021/08/11/elastic-ilm.html">&lt;h1 id=&quot;elasticsearch-ilm-로그-주기-관리-정책&quot;&gt;Elasticsearch ILM 로그 주기 관리 정책&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-logo.png&quot; alt=&quot;elastic-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Elasticsearch의 인덱스 주기 정책 개요 및 설정&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;개요&quot;&gt;개요&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.x/index-lifecycle-management.html&quot;&gt;ILM: Manage the index lifecycle&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ILM(Index Lifecycle Management) 정책을 이용하여 로그 수집 주기를 관리한다.&lt;/p&gt;

&lt;h4 id=&quot;ex&quot;&gt;ex)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;3달치 로그를 저장하고 나머지는 archive&lt;/li&gt;
  &lt;li&gt;인덱스 개수가 일정치를 넘어가면 archive&lt;/li&gt;
  &lt;li&gt;인덱스 사이즈가 일정치를 넘어가면 archive&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위 임계값을 넘으면 아래와 같은 액션 수행이 가능&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Rollover&lt;/strong&gt;: 새로운 쓰기 인덱스를 생성한다.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Shrink&lt;/strong&gt;: 인덱스의 primary shard 수를 줄인다.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Force merge&lt;/strong&gt;: 인덱스 shard의 segment 수를 줄인다.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Freeze&lt;/strong&gt;: 인덱스를 read-only로 만든다.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Delete&lt;/strong&gt;: data, metadata를 포함한 인덱스를 지운다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;index-lifecycle&quot;&gt;Index Lifecycle&lt;/h2&gt;

&lt;p&gt;인덱스의 생명주기는 5가지 페이즈가 있다.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Hot&lt;/strong&gt;: 활발하게 업데이트되고 쿼리되는 인덱스&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Warm&lt;/strong&gt;: 업데이트는 되지 않지만 쿼리되는 인덱스&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Cold&lt;/strong&gt;: 업데이트 되지 않으며 자주 쿼리되지 않는 인덱스(검색이 되어야하지만 느려도 상관 없는 인덱스)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Frozen&lt;/strong&gt;: 업데이트 되지 않으며 드물게 쿼리되는 인덱스(검색이 되어야하지만 심하게 느려도 상관 없는 인덱스)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Delete&lt;/strong&gt;: 더 이상 필요하지 않으며 지워도 상관없는 인덱스&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;각 phase의 minimum age를 설정할 수 있음, 기본값은 0으로 현재 페이즈의 모든 액션이 끝나면 바로 다음 페이즈로 넘어감&lt;/p&gt;

&lt;h3 id=&quot;ilm-기본-정책&quot;&gt;ILM 기본 정책&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.x/getting-started-index-lifecycle-management.html&quot;&gt;Tutorial: Automate rollover with ILM&lt;/a&gt; 참고&lt;/p&gt;

&lt;h3 id=&quot;kibana-ui-이용&quot;&gt;Kibana UI 이용&lt;/h3&gt;

&lt;p&gt;Kibana 메뉴 - Stack Management - Data - Index Lifecycle Policies&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/el-1.png&quot; alt=&quot;el-1.png&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Beats와 Logstash등에 ILM을 활성화하면 기본 정책이 설정된다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;기본정책 확인 가능&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.x/index-lifecycle-management.html&quot;&gt;ILM: Manage the index lifecycle&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.x/getting-started-index-lifecycle-management.html&quot;&gt;Tutorial: Automate rollover with ILM&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Index" /><category term="ILM" /><summary type="html">Elasticsearch ILM 로그 주기 관리 정책</summary></entry><entry><title type="html">Elasticsearch Filebeat 모듈 설정</title><link href="http://localhost:4000/2021/08/06/elastic-filebeat-modules.html" rel="alternate" type="text/html" title="Elasticsearch Filebeat 모듈 설정" /><published>2021-08-06T00:00:00+09:00</published><updated>2021-08-06T00:00:00+09:00</updated><id>http://localhost:4000/2021/08/06/elastic-filebeat-modules</id><content type="html" xml:base="http://localhost:4000/2021/08/06/elastic-filebeat-modules.html">&lt;h1 id=&quot;elastic-filebeat-모듈-설정&quot;&gt;Elastic Filebeat 모듈 설정&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-beats-logo.png&quot; alt=&quot;elastic-beats-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.16/filebeat-modules.html&quot;&gt;Filebeat Modules&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;로그 정보를 수집하는 Filebeat의 모듈별 Output 설정방법을 정리하였다.&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;module-설정&quot;&gt;Module 설정&lt;/h2&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;filebeat-설치&quot;&gt;Filebeat 설치&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/2021/08/05/elastic-filebeat-install.html&quot;&gt;Elastic Filebeat 설치 및 설정&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;module-확인&quot;&gt;Module 확인&lt;/h3&gt;

&lt;p&gt;데이터를 수집하기 위한 filebeat의 module list 확인&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;
&lt;h3 id=&quot;system-module-설정&quot;&gt;System module 설정&lt;/h3&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;system
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;kafka-module-설정&quot;&gt;Kafka module 설정&lt;/h3&gt;

&lt;p&gt;Kafka가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;postgresql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/kafka.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kafka&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/kafka-logs/controller.log*&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/kafka-logs/server.log*&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/kafka-logs/state-change.log*&quot;&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/kafka-logs/kafka-*.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-kafka.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-kafka.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;kafka-dashboards&quot;&gt;kafka dashboards&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-1.png&quot; alt=&quot;efm-1.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;nginx-module-설정&quot;&gt;Nginx module 설정&lt;/h3&gt;

&lt;p&gt;Nginx가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-1&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-1&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/nginx.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Access logs&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;access&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; 
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/var/log/nginx/access.log*&quot;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Error logs&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;- &quot;/var/log/nginx/error.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-nginx.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-nginx.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;nginx-dashboards&quot;&gt;nginx dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-2.png&quot; alt=&quot;efm-2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-3.png&quot; alt=&quot;efm-3.png&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;추가-사항&quot;&gt;추가 사항&lt;/h4&gt;

&lt;p&gt;access.log에 관리자 페이지 관련하여 access_log가 많이 쌓이는 경우&lt;/p&gt;

&lt;p&gt;아래와 같이 access_log off; 추가&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/nginx/conf.d
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim management.conf
        location / &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                access_log off&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;postgresql-module-설정&quot;&gt;PostgreSQL module 설정&lt;/h3&gt;

&lt;p&gt;PostgreSQL이 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-2&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;postgresql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-2&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/postgresql.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;postgresql&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/postgres/pgdata/log/*.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-postgresql.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-postgresql.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;postgresql-dashboards&quot;&gt;postgresql dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-4.png&quot; alt=&quot;efm-4.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;mysql-module-설정&quot;&gt;MySQL module 설정&lt;/h3&gt;

&lt;p&gt;MySQL이 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-3&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-3&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/mysql.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mysql&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/mysql/logs/error.log*&quot;&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;slowlog&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/mysql/logs/mysql-slow.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-mysql.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-mysql.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;mysql-dashboards&quot;&gt;mysql dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-5.png&quot; alt=&quot;efm-5.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;mongodb-module-설정&quot;&gt;MongoDB module 설정&lt;/h3&gt;

&lt;p&gt;MongoDB가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-4&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mongodb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-4&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/mongodb.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mongodb&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/mongo/logs/*.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-mongodb.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-mongodb.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;mongodb-dashboards&quot;&gt;mongodb dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-6.png&quot; alt=&quot;efm-6.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;redis-module-설정&quot;&gt;Redis module 설정&lt;/h3&gt;

&lt;p&gt;Redis가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-5&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;redis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-5&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/filebeat/modules.d/redis.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;var.paths&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/data/redis/redis-server.log*&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-redis.html&quot;&gt;https://www.elastic.co/guide/en/beats/filebeat/7.x/filebeat-module-redis.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;redis-dashboards&quot;&gt;redis dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efm-7.png&quot; alt=&quot;efm-7.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;filebeat-setup&quot;&gt;Filebeat setup&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# dashboard 생성을 위해 /usr/share/filebeat 이동하여 실행&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/share/filebeat

&lt;span class=&quot;c&quot;&gt;# -e 옵션으로 error 여부를 stdout 으로 출력. log에서 host에 정상 접속 했는지 확인 가능&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat setup &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/filebeat/filebeat.yml &lt;span class=&quot;nt&quot;&gt;--dashboards&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;setup 완료 후 마지막 문장에 dashboard가 정상 로딩된 것을 확인
&lt;img src=&quot;/assets/img/contents/efm-8.png&quot; alt=&quot;efm-8.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;filebeat-구동&quot;&gt;Filebeat 구동&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start filebeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;filebeat-log-확인&quot;&gt;Filebeat log 확인&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;journalctl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; filebeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.16/filebeat-modules.html&quot;&gt;Filebeat Modules&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Filebeat" /><category term="Beat" /><summary type="html">Elastic Filebeat 모듈 설정</summary></entry><entry><title type="html">Elastic Filebeat 설치 및 설정</title><link href="http://localhost:4000/2021/08/05/elastic-filebeat-install.html" rel="alternate" type="text/html" title="Elastic Filebeat 설치 및 설정" /><published>2021-08-05T00:00:00+09:00</published><updated>2021-08-05T00:00:00+09:00</updated><id>http://localhost:4000/2021/08/05/elastic-filebeat-install</id><content type="html" xml:base="http://localhost:4000/2021/08/05/elastic-filebeat-install.html">&lt;h1 id=&quot;elastic-filebeat-설치-및-설정&quot;&gt;Elastic Filebeat 설치 및 설정&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-beats-logo.png&quot; alt=&quot;elastic-beats-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.16/filebeat-overview.html&quot;&gt;Filebeat Overview&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;로그 정보를 수집하는 Filebeat를 각 VM(Ubuntu)에 설치하여 로그 파일을 Elasticsearch로 전송한다.&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;filebeat란&quot;&gt;Filebeat란&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/efi-1.png&quot; alt=&quot;efi-1.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Elastic Stack에 포함되는 오픈소스로 파일 데이터와 로그 데이터를 경량화된 방식으로 수집하고 Logstash, Elasticsearch, Kibana 등으로 전달하는 수집기&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;filebeat-설치&quot;&gt;Filebeat 설치&lt;/h2&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 설치&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.12.1-amd64.deb
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dpkg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; filebeat-7.12.1-amd64.deb

&lt;span class=&quot;c&quot;&gt;# 설치 후 설치된 버전 upgrade 막기&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-mark hold filebeat

&lt;span class=&quot;c&quot;&gt;# bin path를 .zshrc 파일에 추가 후 적용&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/filebeat/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; .zshrc

&lt;span class=&quot;c&quot;&gt;# filebeat 설정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/filebeat
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim filebeat.yml

&lt;span class=&quot;c&quot;&gt;# system 재부팅 시 자동 실행 설정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;filebeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;yaml에-elasticsearch-kibana-호스트-정보-설정&quot;&gt;yaml에 elasticsearch, kibana 호스트 정보 설정&lt;/h3&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# =================================== Kibana ===================================&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;setup.kibana&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.6:5601&quot;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# ---------------------------- Elasticsearch Output ----------------------------&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;output.elasticsearch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.68:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.23:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.44:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;elastic&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;elastic&quot;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# ---------------------------- Filebeat inputs ----------------------------&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;filebeat.inputs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;log&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;elasticsearch-https-보안-설정-되어-있을-경우&quot;&gt;elasticsearch https 보안 설정 되어 있을 경우&lt;/h3&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# ---------------------------- Elasticsearch Output ----------------------------&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;output.elasticsearch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.68:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.23:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;10.213.196.44:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;elastic&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;elastic&quot;&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;# ssl verification을 하지 않거나 인증서를 수동으로 등록하여야한다. 아래 택 1&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;# ssl 검증하지 않기&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.verification_mode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;none&quot;&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate_authorities&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/elasticsearch/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/elasticsearch/certs/data1.crt&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/elasticsearch/certs/data1.key&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;filebeat-구동-및-확인&quot;&gt;Filebeat 구동 및 확인&lt;/h2&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/share/filebeat
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;filebeat setup &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/filebeat/filebeat.yml &lt;span class=&quot;nt&quot;&gt;--dashboards&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start filebeat
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status filebeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;로그-확인&quot;&gt;로그 확인&lt;/h3&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;journalctl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; filebeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;filebeat-모듈-설정&quot;&gt;Filebeat 모듈 설정&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/2021/08/06/elastic-filebeat-modules.html&quot;&gt;Elastic Filebeat 모듈 설정&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.16/filebeat-overview.html&quot;&gt;Filebeat Overview&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Filebeat" /><category term="Beat" /><summary type="html">Elastic Filebeat 설치 및 설정</summary></entry><entry><title type="html">Elasticsearch Metricbeat 모듈 설정</title><link href="http://localhost:4000/2021/08/02/elastic-metricbeat-modules.html" rel="alternate" type="text/html" title="Elasticsearch Metricbeat 모듈 설정" /><published>2021-08-02T00:00:00+09:00</published><updated>2021-08-02T00:00:00+09:00</updated><id>http://localhost:4000/2021/08/02/elastic-metricbeat-modules</id><content type="html" xml:base="http://localhost:4000/2021/08/02/elastic-metricbeat-modules.html">&lt;h1 id=&quot;elastic-metricbeat-모듈-설정&quot;&gt;Elastic Metricbeat 모듈 설정&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-beats-logo.png&quot; alt=&quot;elastic-beats-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-modules.html&quot;&gt;Metricbeat Modules&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;메트릭 정보를 수집하는 Metricbeat의 모듈별 Output 설정방법을 정리하였다.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;module-설정&quot;&gt;Module 설정&lt;/h2&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;metricbeat-설치&quot;&gt;Metricbeat 설치&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/2021/07/27/elastic-metricbeat-install.html&quot;&gt;Metricbeat 설치 및 설정&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;module-확인&quot;&gt;Module 확인&lt;/h3&gt;
&lt;p&gt;metric을 수집하기 위한 metricbeat의 module들 list 확인&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;
&lt;h3 id=&quot;system-module-설정&quot;&gt;System module 설정&lt;/h3&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 필요 시 system 모듈 설정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vi /etc/metricbeat/modules.d/system.yml

&lt;span class=&quot;c&quot;&gt;# 추가 module 없이 활성화를 하면 system metric만 수집함.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;postgresql-module-설정&quot;&gt;Postgresql module 설정&lt;/h3&gt;

&lt;p&gt;Postgres이 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;postgresql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/postgresql.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;postgresql&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;database&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bgwriter&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;activity&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;statement&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;postgres://10.213.196.207:5432?sslmode=disable&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;postgres&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;암호&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-postgresql.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-postgresql.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;postgresql-dashboards&quot;&gt;postgresql dashboards&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-1.png&quot; alt=&quot;emm-1.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;redis-module-설정&quot;&gt;Redis module 설정&lt;/h3&gt;

&lt;p&gt;Redis가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-1&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;redis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-1&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/redis.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;info&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;keyspace&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;127.0.0.1:6379&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-redis.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-redis.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;redis-dashboards&quot;&gt;redis dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-2.png&quot; alt=&quot;emm-2.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;mongodb-module-설정&quot;&gt;Mongodb module 설정&lt;/h3&gt;

&lt;p&gt;Mongodb가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-2&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mongodb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-2&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/mongodb.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mongodb&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;dbstats&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;status&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;collstats&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;metrics&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;localhost:27017&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-mongodb.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-mongodb.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;mongodb-dashboards&quot;&gt;mongodb dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-3.png&quot; alt=&quot;emm-3.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;mysql-module-설정&quot;&gt;MySQL module 설정&lt;/h3&gt;

&lt;p&gt;MySQL이 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-3&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-3&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/mysql.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mysql&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;status&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;performance&lt;/span&gt;
    
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;metricbeat:password1234@tcp(127.0.0.1:13306)/&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-mysql.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-mysql.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;접속-에러시&quot;&gt;접속 에러시&lt;/h4&gt;

&lt;p&gt;mysql의 root 계정이 localhost에서만 접속하도록 되어 있는지 확인&lt;/p&gt;

&lt;p&gt;ex) docker의 경우 컨테이너 접속시 host ip로 접속&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# host ip 확인&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ifconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;mysql 접속하여 계정 생성 및 권한부여&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;docer &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; mysql bash
mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;host, user from mysql.user&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+-----------+------------------+
| host      | user             |
+-----------+------------------+
| localhost | mysql.infoschema |
| localhost | mysql.session    |
| localhost | mysql.sys        |
| localhost | root             |
+-----------+------------------+
7 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; create user &lt;span class=&quot;s1&quot;&gt;&apos;metricbeat&apos;&lt;/span&gt;@&lt;span class=&quot;s1&quot;&gt;&apos;172.18.0.1&apos;&lt;/span&gt; identified by &lt;span class=&quot;s1&quot;&gt;&apos;password1234&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.02 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; grant all privilieges on &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; to &lt;span class=&quot;s1&quot;&gt;&apos;metricbeat&apos;&lt;/span&gt;@&lt;span class=&quot;s1&quot;&gt;&apos;172.18.0.1&apos;&lt;/span&gt; identified by &lt;span class=&quot;s1&quot;&gt;&apos;password1234&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; flush privileges&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;자세한 내용은 &lt;a href=&quot;http://localhost:4000/2021/05/31/mysql-install.html&quot;&gt;MySQL 설치 및 사용자 생성&lt;/a&gt; 참조&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;mysql-dashboards&quot;&gt;mysql dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-4.png&quot; alt=&quot;emm-4.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;nginx-module-설정&quot;&gt;Nginx module 설정&lt;/h3&gt;

&lt;p&gt;Nginx가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-4&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-4&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/nginx.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nginx&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;stubstatus&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Nginx hosts&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://127.0.0.1:9000&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Path to server status. Default server-status&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;server_status_path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;server-status&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-nginx.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-nginx.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;nginx의-ngx_http_stub_status_module-모듈-활성화&quot;&gt;nginx의 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ngx_http_stub_status_module&lt;/code&gt; 모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd /etc/nginx/conf.d
$ vim status.conf
    server {
        listen 9000;

		location /server-status {
          stub_status;	# stub_status 활성화
          access_log off;	# 접속 로그 비활성화
          allow 127.0.0.1;	# localhost에서만 접속 허용
          deny all;
		}
    }
$ chmod 750 status.conf
$ chown nginx:nginx status.conf
$ nginx -s reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;metricbeat가 10초마다 localhost:9000/server-status를 호출하여 stub status 정보 가져감&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;nginx-dashboards&quot;&gt;nginx dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-5.png&quot; alt=&quot;emm-5.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-6.png&quot; alt=&quot;emm-6.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-7.png&quot; alt=&quot;emm-7.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;kafka-module-설정&quot;&gt;Kafka module 설정&lt;/h3&gt;

&lt;p&gt;Kafka가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-5&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;kafka
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-5&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/kafka.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kafka&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;partition&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;consumergroup&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;broker&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;consumer&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;producer&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;localhost:9092&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-kafka.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-kafka.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;kafka-with-jolokia&quot;&gt;Kafka with jolokia&lt;/h4&gt;

&lt;p&gt;broker, consumer, producer metricset을 가져오려면 jolokia를 이용하여 jmx 모니터링하여야한다.&lt;/p&gt;

&lt;p&gt;kafka에 jolokia가 javaagent로 붙어서 jvm 위에 실행&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.to/martinhynar/monitoring-kafka-brokers-using-jolokia-metricbeat-and-elasticsearch-5678&quot;&gt;https://dev.to/martinhynar/monitoring-kafka-brokers-using-jolokia-metricbeat-and-elasticsearch-5678&lt;/a&gt; 참조&lt;/p&gt;

&lt;h4 id=&quot;kafka-dashboards&quot;&gt;kafka dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-8.png&quot; alt=&quot;emm-8.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;zookeeper-module-설정&quot;&gt;Zookeeper module 설정&lt;/h3&gt;

&lt;p&gt;Zookeeper가 설치되어 있는 VM에 진행&lt;/p&gt;

&lt;h4 id=&quot;모듈-활성화-6&quot;&gt;모듈 활성화&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;zookeeper
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;모듈-설정-6&quot;&gt;모듈 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/metricbeat/modules.d/zookeeper.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;zookeeper&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;connection&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mntr&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;localhost:2181&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ref: &lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-zookeeper.html&quot;&gt;https://www.elastic.co/guide/en/beats/metricbeat/7.x/metricbeat-module-zookeeper.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;zookeeper-dashboards&quot;&gt;zookeeper dashboards&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emm-9.png&quot; alt=&quot;emm-9.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;metricbeat-setup&quot;&gt;Metricbeat setup&lt;/h2&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# dashboard 생성을 위해 /usr/share/metricbeat 이동하여 실행&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/share/metricbeat

&lt;span class=&quot;c&quot;&gt;# -e 옵션으로 error 여부를 stdout 으로 출력. log에서 host에 정상 접속 했는지 확인 가능&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat setup &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/metricbeat/metricbeat.yml &lt;span class=&quot;nt&quot;&gt;--dashboards&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;setup 완료 후 마지막 문장에 dashboard가 정상 로딩된 것을 확인
&lt;img src=&quot;/assets/img/contents/emm-10.png&quot; alt=&quot;emm-10.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;metricbeat-구동&quot;&gt;Metricbeat 구동&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start metricbeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;metricbeat-log-확인&quot;&gt;Metricbeat log 확인&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;journalctl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; metricbeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-modules.html&quot;&gt;Metricbeat Modules&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Metricbeat" /><category term="Beat" /><summary type="html">Elastic Metricbeat 모듈 설정</summary></entry><entry><title type="html">Elastic Metricbeat 설치 및 설정</title><link href="http://localhost:4000/2021/07/27/elastic-metricbeat-install.html" rel="alternate" type="text/html" title="Elastic Metricbeat 설치 및 설정" /><published>2021-07-27T00:00:00+09:00</published><updated>2021-07-27T00:00:00+09:00</updated><id>http://localhost:4000/2021/07/27/elastic-metricbeat-install</id><content type="html" xml:base="http://localhost:4000/2021/07/27/elastic-metricbeat-install.html">&lt;h1 id=&quot;elastic-metricbeat-설치-및-설정&quot;&gt;Elastic Metricbeat 설치 및 설정&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-beats-logo.png&quot; alt=&quot;elastic-beats-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-overview.html&quot;&gt;Metricbeat Overview&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;로그 정보를 수집하는 Filebeat를 각 VM(Ubuntu)에 설치하여 로그 파일을 Elasticsearch로 전송한다.&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;metricbeat란&quot;&gt;Metricbeat란&lt;/h2&gt;

&lt;p&gt;Elastic Stack에 포함되는 오픈소스로 시스템과 서비스의 규격화된 메트릭 정보를 경량화된 방식으로 수집하고 Logstash, Elasticsearch, Kibana 등으로 전달하는 수집기&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;metricbeat-설치&quot;&gt;Metricbeat 설치&lt;/h2&gt;
&lt;p&gt;현재 설치된 elasticsearch 버전을 확인 후 &lt;strong&gt;호환되는 버전&lt;/strong&gt;의 metricbeat를 설치한다.&lt;/p&gt;

&lt;p&gt;되도록 elaticsearch 버전과 동일한 버전의 metricbeat을 설치한다.&lt;/p&gt;

&lt;p&gt;elastic component들 과거버전 선택 download:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;https://www.elastic.co/kr/downloads/past-releases&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;metricbeat 7.11.2 download url:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;https://www.elastic.co/downloads/past-releases/metricbeat-7-11-2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;wget 으로 7.11.2 버전을 download 및 설치:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 다운로드&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.11.2-amd64.deb

&lt;span class=&quot;c&quot;&gt;# CentOS 7 용(rpm)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.12.1-x86_64.rpm

&lt;span class=&quot;c&quot;&gt;# 설치&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dpkg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; metricbeat-7.11.2-amd64.deb
&lt;span class=&quot;c&quot;&gt;# 7.12.1 버전&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dpkg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; metricbeat-7.12.1-amd64.deb
&lt;span class=&quot;c&quot;&gt;#CentOS rpm&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rpm &lt;span class=&quot;nt&quot;&gt;-ivh&lt;/span&gt; ./metricbeat-7.12.1-x86_64.rpm

&lt;span class=&quot;c&quot;&gt;# 설치 후 설치된 버전 upgrade 막기&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;apt-mark hold metricbeat

&lt;span class=&quot;c&quot;&gt;# 설치파일 삭제&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;metricbeat-7.11.2-amd64.deb

&lt;span class=&quot;c&quot;&gt;# bin path를 .zshrc 파일에 추가 후 적용&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/metricbeat/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; .zshrc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;system booting 시 자동 실행 등록.&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;metricbeat.service
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl daemon-reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;metricbeat-설정&quot;&gt;Metricbeat 설정&lt;/h2&gt;
&lt;p&gt;metricbeat 설치 후 elasticsearch로의 접속 설정 및 보안 설정 진행&lt;/p&gt;

&lt;p&gt;config directory:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;/etc/metricbeat&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;config file:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;metricbeat.yml&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;metricbeat-접속-설정-및-보안-설정&quot;&gt;Metricbeat 접속 설정 및 보안 설정&lt;/h3&gt;
&lt;p&gt;미리 구축해둔 elasticsearch에 연결할 예정이므로 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output.elasticsearch&lt;/code&gt; 섹션에 연결 설정을 진행한다.&lt;/p&gt;

&lt;p&gt;설정 진행 시 ssl 부분도 설정하며 인증서 파일은 data node용으로 만들어둔 인증서를 사용한다.&lt;/p&gt;

&lt;p&gt;elasticsearch 연결 설정:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output.elasticsearch&lt;/code&gt; 값을 설정&lt;/li&gt;
  &lt;li&gt;username, password 는 hard-coded 하지 말고 serets keystore 등으로 대체 필요&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;metricbeat.yml 설정 내용 - &lt;strong&gt;SSL 인증 키 없이&lt;/strong&gt; http 접속 시 아래 설정 사용&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kibana 접속 정보 설정.&lt;/span&gt;
setup.kibana:
  host: &lt;span class=&quot;s2&quot;&gt;&quot;http://10.213.196.6:5601&quot;&lt;/span&gt;

output.elasticsearch:
  &lt;span class=&quot;c&quot;&gt;# master node들 &lt;/span&gt;
  hosts: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;10.213.196.68:9200&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;10.213.196.23:9200&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;10.213.196.44:9200&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;# 보안설정 후 https 접속&lt;/span&gt;
  protocol: &lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;

  username: &lt;span class=&quot;s2&quot;&gt;&quot;elastic&quot;&lt;/span&gt;
  password: &lt;span class=&quot;s2&quot;&gt;&quot;elastic&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;metricbeat.yml 설정 내용 - SSL 인증 키 생성하여 적용 시 아래 설정 사용:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kibana 접속 정보 설정.&lt;/span&gt;
setup.kibana:
  host: &lt;span class=&quot;s2&quot;&gt;&quot;https://172.25.0.166:5601&quot;&lt;/span&gt;

  ssl:
    enabled: &lt;span class=&quot;nb&quot;&gt;true
    &lt;/span&gt;certificate_authorities: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    certificate: &lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/data1.crt&quot;&lt;/span&gt;
    key: &lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/data1.key&quot;&lt;/span&gt;
    
output.elasticsearch:
  &lt;span class=&quot;c&quot;&gt;# master node들 &lt;/span&gt;
  hosts: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;172.25.0.92:9200&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;172.25.0.159:9200&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;172.25.0.121:9200&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;# 보안설정 후 https 접속&lt;/span&gt;
  protocol: &lt;span class=&quot;s2&quot;&gt;&quot;https&quot;&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;#api_key: &quot;id:api_key&quot;&lt;/span&gt;
  username: &lt;span class=&quot;s2&quot;&gt;&quot;elastic&quot;&lt;/span&gt;
  password: &lt;span class=&quot;s2&quot;&gt;&quot;{암호}&quot;&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;# tls 설정 값. logstash-1 서버에 적용중이기 때문에 해당 node의 인증서를 적용&lt;/span&gt;
  ssl:
    certificate_authorities: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    certificate: &lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/data1.crt&quot;&lt;/span&gt;
    key: &lt;span class=&quot;s2&quot;&gt;&quot;/etc/elasticsearch/certs/data1.key&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;설정파일 테스트. 설정 파일이 위치한 directory 에서 테스트 가능하며 테스트 후 OK가 출력되면 OK:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 테스트 진행 후 Confg OK 출력 확인&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat &lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;config &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/contents/emi-1.png&quot; alt=&quot;emi-1.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;system-module-설정&quot;&gt;System module 설정&lt;/h2&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 필요 시 system 모듈 설정&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vi /etc/metricbeat/modules.d/system.yml

&lt;span class=&quot;c&quot;&gt;# 추가 module 없이 활성화를 하면 system metric만 수집함.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;metricbeat-setup&quot;&gt;Metricbeat Setup&lt;/h3&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# asset 로딩 시 dashboard 생성을 위해 /usr/share/metricbeat 으로 이동하여 실행&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/share/metricbeat

&lt;span class=&quot;c&quot;&gt;# -e 옵션으로 error 여부를 stdout 으로 출력. log에서 host에 정상 접속 했는지 확인 가능&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat setup &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/metricbeat/metricbeat.yml &lt;span class=&quot;nt&quot;&gt;--dashboards&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;metricbeat-구동--metric-값-전송&quot;&gt;Metricbeat 구동 &amp;amp; metric 값 전송&lt;/h3&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start metricbeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;metricbeat-모듈-설정&quot;&gt;Metricbeat 모듈 설정&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/2021/08/02/elastic-metricbeat-modules.html&quot;&gt;Elastic Metricbeat 모듈 설정&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-overview.html&quot;&gt;Metricbeat Overview&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Metricbeat" /><category term="Beat" /><summary type="html">Elastic Metricbeat 설치 및 설정</summary></entry><entry><title type="html">Elastic Stack Monitoring with Metricbeat</title><link href="http://localhost:4000/2021/07/27/elastic-stack-monitoring.html" rel="alternate" type="text/html" title="Elastic Stack Monitoring with Metricbeat" /><published>2021-07-27T00:00:00+09:00</published><updated>2021-07-27T00:00:00+09:00</updated><id>http://localhost:4000/2021/07/27/elastic-stack-monitoring</id><content type="html" xml:base="http://localhost:4000/2021/07/27/elastic-stack-monitoring.html">&lt;h1 id=&quot;elastic-stack-monitoring-with-metricbeat&quot;&gt;Elastic Stack Monitoring with Metricbeat&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/titles/elastic-logo.png&quot; alt=&quot;elastic-logo.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Elastic Stack(ELK) 노드 자체의 메트릭 정보를 모니터링하기 위한 metricbeat 구축하기&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;개요&quot;&gt;개요&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/monitoring-metricbeat-collection.html&quot;&gt;Use Metricbeat to send monitoring data&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Metricbeat를 사용하여 ELS(Elastic Stack) 모니터링 구축&lt;/p&gt;

&lt;p&gt;기존 Legacy 수집 방식과 Metricbeat 수집 방식이 있으나 7.x 버전에서는 Metricbeat를 사용하여 모니터링하도록 가이드하고 있다.&lt;/p&gt;

&lt;p&gt;아래 5가지 항목을 모니터링한다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Elasticsearch&lt;/li&gt;
  &lt;li&gt;Logstash&lt;/li&gt;
  &lt;li&gt;Kibana&lt;/li&gt;
  &lt;li&gt;Beats&lt;/li&gt;
  &lt;li&gt;APM&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;기존 Metricbeat로 수집되는 메트릭 정보들은 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;metricbeat-*&lt;/code&gt; 인덱스에 수집이 되지만 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xpack.enabled&lt;/code&gt; 옵션으로 xpack 기능 활성화시 별도의 monitoring cluster로 수집하며 Kibana의 Stack Monitoring 메뉴에서 확인할 수 있다.&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;metricbeat-설치&quot;&gt;Metricbeat 설치&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;2021-07-27-elastic-metricbeat-install&quot;&gt;Elastic Metricbeat 설치 및 설정&lt;/a&gt; 참고&lt;/p&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;metricbeat-설정&quot;&gt;Metricbeat 설정&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;metricbeat.yml&lt;/code&gt; 수정&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;setup.kibana&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://10.213.196.6:5601&quot;&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서 생성 시 https 사용&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://172.25.0.166:5601&quot;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서 적용 시 추가&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate_authorities&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/logstash-1.crt&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/logstash-1.key&quot;&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;output.elasticsearch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# elasticsearch 노드 IP 넣기&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{엘라스틱서치1}:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{엘라스틱서치2}:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{엘라스틱서치3}:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서 적용 시 https, 미 적용 시 http 사용&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https&quot;&lt;/span&gt;

  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;elastic&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;{암호}&quot;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서 적용시&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate_authorities&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;certificate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/logstash-1.crt&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/logstash/certs/logstash-1.key&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;elastic stack monitoring 활성화시 시스템 정보를 수집해도 UI에 보이지 않으므로 비활성화한다.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules disable system
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;elasticsearch-monitoring&quot;&gt;Elasticsearch Monitoring&lt;/h2&gt;

&lt;h3 id=&quot;elasticsearch-설정&quot;&gt;Elasticsearch 설정&lt;/h3&gt;
&lt;h4 id=&quot;elasticsearchyml-수정&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;elasticsearch.yml&lt;/code&gt; 수정&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;xpack.monitoring.collection.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;# xpack 모니터링(metricbeat 사용)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;monitoring.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;									&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;# legacy 모니터링(metricbeat 미사용)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;기존 legacy 방식 모니터링은 false, xpack 모니터링은 true로 설정&lt;/p&gt;

&lt;h4 id=&quot;elasticsearch-xpack-module-활성화&quot;&gt;elasticsearch-xpack module 활성화&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules disable elasticsearch
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;elasticsearch-xpack
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;xpack과 기본 모듈중 하나만 사용해야 하기 때문에 기존의 모듈은 disable&lt;/p&gt;

&lt;h4 id=&quot;elasticsearch-xpack-module-설정&quot;&gt;elasticsearch-xpack module 설정&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;modules.d/elasticsearch-xpack.yml&lt;/code&gt; 수정&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;elasticsearch&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;xpack.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://localhost:9200&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://localhost:9201&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://localhost:9202&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;# elasticsearch 모니터링용 user(Optional)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#username: &quot;user&quot;&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#password: &quot;secret&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;elasticsearch-모니터링용-사용자-생성optional&quot;&gt;elasticsearch 모니터링용 사용자 생성(Optional)&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;remote_monitoring_collector&lt;/code&gt; 롤을 가진 사용자를 생성. 생성한 사용자 id는 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;elasticsearch_monitoring&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;metricbeat-구동-및-kibana에서-확인&quot;&gt;Metricbeat 구동 및 kibana에서 확인&lt;/h3&gt;
&lt;h4 id=&quot;metricbeat-서비스-구동&quot;&gt;metricbeat 서비스 구동&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start metricbeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;kibana-stack-monitoring-메뉴에서-metricbeat-monitoring-상태임을-확인&quot;&gt;kibana Stack Monitoring 메뉴에서 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metricbeat monitoring&lt;/code&gt; 상태임을 확인&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/esm-1.png&quot; alt=&quot;esm-1.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;logstash-monitoring&quot;&gt;Logstash Monitoring&lt;/h2&gt;

&lt;h3 id=&quot;logstash-설정&quot;&gt;Logstash 설정&lt;/h3&gt;

&lt;h4 id=&quot;기본-모니터링-설정-끄기&quot;&gt;기본 모니터링 설정 끄기&lt;/h4&gt;
&lt;p&gt;kibana에서 stack monitoring 확인 시 Self monitoring으로 표기될 시 기본 모니터링 옵션을 끈다.
&lt;img src=&quot;/assets/img/contents/esm-2.png&quot; alt=&quot;esm-2.png&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;logstashyml에-추가&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logstash.yml&lt;/code&gt;에 추가&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;monitoring.enabled: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;logstash-xpack-모듈-활성화&quot;&gt;logstash-xpack 모듈 활성화&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules disable logstash
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;logstash-xpack
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;xpack과 기본 모듈중 하나만 사용해야 하기 때문에 기존의 모듈은 disable&lt;/p&gt;

&lt;h4 id=&quot;logstash-xpack-모듈-설정&quot;&gt;logstash-xpack 모듈 설정&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/logstash/7.12/monitoring-with-metricbeat.html&quot;&gt;Collect Logstash monitorin data with Metricbeat&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;modulesdlogstash-xpackyml-수정&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;modules.d/logstash-xpack.yml&lt;/code&gt; 수정&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;logstash&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;node&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;node_stats&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;xpack.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# hosts 값에는 metric 수집 대상을 추가. &lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://172.25.0.66:9600&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# logstash 모니터링용 사용자(Optional)&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;logstash_monitoring&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Infra1111&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;logstash-모니터링용-user-생성optional&quot;&gt;logstash 모니터링용 user 생성(Optional)&lt;/h4&gt;
&lt;p&gt;kibana web ui 에서 아래 화면과 같이 모니터링용 user를 생성
&lt;img src=&quot;/assets/img/contents/esm-3.png&quot; alt=&quot;esm-3.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;roles에는 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;remote_monitoring_collector&lt;/code&gt; 를 선택&lt;/p&gt;

&lt;h3 id=&quot;metricbeat-구동-및-kibana에서-확인-1&quot;&gt;Metricbeat 구동 및 kibana에서 확인&lt;/h3&gt;

&lt;h4 id=&quot;metricbeat-서비스-구동-1&quot;&gt;metricbeat 서비스 구동&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start metricbeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;kibana-stack-monitoring-메뉴에서-metricbeat-monitoring-상태임을-확인-1&quot;&gt;kibana Stack Monitoring 메뉴에서 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metricbeat monitoring&lt;/code&gt; 상태임을 확인&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/esm-4.png&quot; alt=&quot;esm-4.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;kibana-monitoring&quot;&gt;Kibana Monitoring&lt;/h2&gt;

&lt;h3 id=&quot;kibana-설정&quot;&gt;Kibana 설정&lt;/h3&gt;

&lt;h4 id=&quot;기본-모니터링-설정-끄기-1&quot;&gt;기본 모니터링 설정 끄기&lt;/h4&gt;

&lt;p&gt;kibana에서 stack monitoring 확인 시 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Self monitoring&lt;/code&gt;으로 표기될 시 기본 모니터링 옵션을 끈다.
&lt;img src=&quot;/assets/img/contents/esm-5.png&quot; alt=&quot;esm-5.png&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;kibanayml에-추가&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kibana.yml&lt;/code&gt;에 추가&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;monitoring.kibana.collection.enabled: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;기존 legacy 방식으로 모니터링 데이터를 수집하는 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;monitoring.kibana.collection.enabled&lt;/code&gt; 설정 값을 false로 변경.&lt;/p&gt;

&lt;h4 id=&quot;kibana-xpack-module-활성화&quot;&gt;kibana-xpack module 활성화&lt;/h4&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules disable kibana
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;metricbeat modules &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;kibana-xpack
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;xpack과 기본 모듈중 하나만 사용해야 하기 때문에 기존의 모듈은 disable&lt;/p&gt;

&lt;h4 id=&quot;kibana-xpack-module-설정&quot;&gt;kibana-xpack module 설정&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-kibana.html&quot;&gt;Kibana module&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;modulesdkibana-xpackyml-수정&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;modules.d/kibana-xpack.yml&lt;/code&gt; 수정&lt;/h4&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;kibana&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# 두 개의 metricset 설정 가능.&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;metricsets&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;stats&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;status&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# metricbeat로 모니터링 시 아래 옵션을 true로 설정해야 함&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;xpack.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;period&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10s&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# kibana 서버 url&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://10.213.196.6:5601&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;scopse&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;node&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# kibana 모니터링용 user(Optional)&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;kibana_monitoring&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Infra1111&quot;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# ssl 인증서 생성하여 적용 시 아래 옵션 적용&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.certificate_authorities&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/kibana/certs/ca.crt&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.certificate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/kibana/certs/rmakers-kibana.crt&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/etc/kibana/certs/rmakers-kibana.key&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ssl.verification_mode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;full&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;kibana-모니터링용-사용자-생성optional&quot;&gt;kibana 모니터링용 사용자 생성(Optional)&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;remote_monitoring_collector&lt;/code&gt; 롤을 가진 사용자를 생성. 생성한 사용자 id는 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kibana_monitoring&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;metricbeat-구동-및-kibana에서-확인-2&quot;&gt;Metricbeat 구동 및 kibana에서 확인&lt;/h3&gt;
&lt;h4 id=&quot;metricbeat-서비스-구동-2&quot;&gt;metricbeat 서비스 구동&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl start metricbeat.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;kibana-stack-monitoring-메뉴에서-metricbeat-monitoring-상태임을-확인-2&quot;&gt;kibana Stack Monitoring 메뉴에서 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metricbeat monitoring&lt;/code&gt; 상태임을 확인&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/contents/esm-6.png&quot; alt=&quot;esm-6.png&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/7.x/monitoring-metricbeat-collection.html&quot;&gt;Use Metricbeat to send monitoring data&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/logstash/7.12/monitoring-with-metricbeat.html&quot;&gt;Collect Logstash monitorin data with Metricbeat&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-kibana.html&quot;&gt;Kibana module&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>csupreme19</name></author><category term="Elasticsearch" /><category term="Elastic" /><category term="ELK" /><category term="Metricbeat" /><category term="Metric" /><category term="Monitoring" /><category term="Observability" /><summary type="html">Elastic Stack Monitoring with Metricbeat</summary></entry></feed>