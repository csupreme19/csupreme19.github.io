I"Øs<h1 id="kubernetes-dashboard-ì„¤ì¹˜-ë°-ì™¸ë¶€ì ‘ì†-ì„¤ì •">Kubernetes Dashboard ì„¤ì¹˜ ë° ì™¸ë¶€ì ‘ì† ì„¤ì •</h1>

<p><img src="/assets/img/titles/kubernetes-logo.png" alt="kubernetes-logo.png" /></p>

<p><a href="https://github.com/kubernetes/dashboard">kubernetes dashboard</a></p>

<p>Kubernetes dashboardë¥¼ êµ¬ì„± í›„ ì™¸ë¶€ì ‘ì† ì„¤ì •</p>

<hr />
<h2 id="kubernetes-dashboard-ì„¤ì¹˜">Kubernetes dashboard ì„¤ì¹˜</h2>

<h3 id="using-k8s-deployment">Using K8S Deployment</h3>

<h4 id="1-kubernetes-dashboard-template-ê°€ì ¸ì˜¤ê¸°">1. kubernetes dashboard template ê°€ì ¸ì˜¤ê¸°</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml
<span class="nv">$ </span><span class="nb">mv </span>recommended.yaml kubernetes-dashboard.yaml <span class="c"># ì´ë¦„ ë³€ê²½(í¸ì˜ìƒ)</span>
</code></pre></div></div>

<h4 id="2-serviceaccount-ìƒì„±-ë°-rbac-ì„¤ì •">2. ServiceAccount ìƒì„± ë° RBAC ì„¤ì •</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim kubernetes-dashboard-rbac.yaml
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">admin-user</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">admin-user</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cluster-admin</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">admin-user</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
</code></pre></div></div>

<p>ìœ„ ì„¤ì •ì€ í˜„ì¬ k8sì— ë¯¸ë¦¬ ì •ì˜ë˜ì–´ ìˆëŠ” cluster-admin ì—­í• ì„ ë°”ì¸ë”©í•˜ë¯€ë¡œ í•´ë‹¹ SAì˜ í† í°ìœ¼ë¡œ ì ‘ì†ì‹œ clusterì˜ ëª¨ë“  ê¶Œí•œì„ íšë“í•œë‹¤.</p>

<p>ëª¨ë‹ˆí„°ë§ SAì˜ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì‹ ê·œ Roleì„ ìƒì„±í•˜ì—¬ ê¶Œí•œì„ ì§€ì •í•˜ì—¬ ë°”ì¸ë”©í•œë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---</span>
apiVersion: v1
kind: ServiceAccount
metadata:
  name: monitoring-user
  namespace: kubernetes-dashboard
<span class="nt">---</span>
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-monitoring
rules:
- apiGroups: <span class="o">[</span><span class="s2">"*"</span><span class="o">]</span>
  resources: <span class="o">[</span><span class="s2">"namespaces"</span>, <span class="s2">"deployments"</span>, <span class="s2">"pods"</span><span class="o">]</span>
  verbs: <span class="o">[</span><span class="s2">"get"</span>, <span class="s2">"list"</span>, <span class="s2">"watch"</span><span class="o">]</span>
<span class="nt">---</span>
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: monitoring-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-monitoring
subjects:
- kind: ServiceAccount
  name: monitoring-user
  namespace: kubernetes-dashboard
</code></pre></div></div>

<blockquote>
  <p>ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ë””í”Œë¡œì´ë¨¼íŠ¸, íŒŒë“œ 3ê°€ì§€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ì„œ ì½ê¸° ê¶Œí•œë§Œ ë¶€ì—¬</p>
</blockquote>

<h4 id="3-ë¡œì»¬-ì ‘ì†-í…ŒìŠ¤íŠ¸">3. ë¡œì»¬ ì ‘ì† í…ŒìŠ¤íŠ¸</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¡œì»¬ k8s í”„ë¡ì‹œ ì‹¤í–‰</span>
<span class="nv">$ </span>kubectl proxy
Starting to serve on 127.0.0.1:8001
<span class="c"># ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>curl <span class="nt">-v</span> http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre></div></div>

<blockquote>
  <p>ì°¸ê³ : <code class="language-plaintext highlighter-rouge">kubernetes-dashboard.yaml</code>ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ëŠ” ëª¨ë‘ kubernetes-dashboardë¼ëŠ” namespaceì•ˆì— ì¡´ì¬í•œë‹¤.</p>
</blockquote>

<h4 id="4-ë² ì–´ëŸ¬-í† í°-ë°œê¸‰">4. ë² ì–´ëŸ¬ í† í° ë°œê¸‰</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í† í° ë°œê¸‰</span>

<span class="nv">$ </span>kubectl <span class="nt">-n</span> kubernetes-dashboard get secret <span class="si">$(</span>kubectl <span class="nt">-n</span> kubernetes-dashboard get sa/<span class="o">{</span>ìœ„ì—ì„œ ìƒì„±í•œ SAëª…<span class="o">}</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.secrets[0].name}"</span><span class="si">)</span> <span class="nt">-o</span> go-template<span class="o">=</span><span class="s2">"{{.data.token | base64decode}}"</span> <span class="o">&gt;&gt;</span> token


<span class="c"># í† í° í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>token
</code></pre></div></div>

<p>Kubernetes dashboardëŠ” ê¸°ë³¸ì ìœ¼ë¡œ APIí˜•íƒœë¡œì˜ ë¡œì»¬ ì ‘ê·¼ë§Œ í—ˆìš©í•˜ê³  ìˆì–´ ì™¸ë¶€ ì ‘ì† ì„¤ì •ì´ ë”°ë¡œ í•„ìš”í•˜ë‹¤.</p>

<hr />
<h2 id="kubernetes-dashboard-ì™¸ë¶€-ì ‘ì†-ì„¤ì •">Kubernetes Dashboard ì™¸ë¶€ ì ‘ì† ì„¤ì •</h2>

<blockquote>
  <p>ì°¸ê³ : Kubernetes DashboardëŠ” ê¸°ë³¸ì ìœ¼ë¡œ https ì—°ê²°ì„ í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©° ë¡œì»¬ì—ì„œì˜ ì ‘ê·¼ë§Œ í—ˆìš©í•œë‹¤</p>
</blockquote>

<p>Kubernetesë¥¼ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¤ëŠ” ë°©ë²•ì€ í¬ê²Œ 4ê°€ì§€ê°€ ìˆë‹¤.</p>

<h4 id="1-proxy-ë°©ì‹">1. Proxy ë°©ì‹</h4>

<h4 id="2-nodeport-ë°©ì‹">2. NodePort ë°©ì‹</h4>

<h4 id="3-api-server-ë°©ì‹">3. API Server ë°©ì‹</h4>

<h4 id="4-ingress-ë°©ì‹">4. Ingress ë°©ì‹</h4>

<p>ë³¸ ë¬¸ì„œì—ì„œëŠ” 4ë²ˆ Ingress ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.</p>

<h3 id="1-proxy-ë°©ì‹-1">1. Proxy ë°©ì‹</h3>

<blockquote>
  <p>kubectl proxyë¥¼ ì´ìš©í•˜ì—¬ í¬íŠ¸ì™€ ì£¼ì†Œë¥¼ ì§€ì •í•œ í›„ Host ë¨¸ì‹ ì— ë„ìš°ëŠ” ë°©ì‹</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl proxy <span class="nt">--port</span><span class="o">=</span>9090 <span class="nt">--address</span><span class="o">=</span>10.109.190.106 <span class="nt">--accept-hosts</span><span class="o">=</span><span class="s1">'^*$'</span>

<span class="nv">$ </span>curl <span class="nt">-k</span> <span class="nt">-v</span> http://10.109.190.106:9090/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/
</code></pre></div></div>

<p>Hostê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì–´ ìˆëŠ” ìƒí™©ì´ë¼ë©´ í•´ë‹¹ IPë¥¼ ì´ìš©í•˜ì—¬ ì™¸ë¶€ì—ì„œë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<h4 id="ë‹¨ì ">ë‹¨ì </h4>

<ul>
  <li>Hostê°€ ì™¸ë¶€ì™€ ì§ì ‘ ì—°ê²°ë˜ëŠ” í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ëŒ€ì‹œë³´ë“œê°€ localhostì—ì„œ ë„ì›Œì ¸ì•¼ë§Œ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ì™¸ë¶€ì—ì„œ ë¬´ì°¨ë³„ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë©° ëª¨ë“  ê¶Œí•œì„ ê°–ëŠ”ë‹¤.</li>
  <li>ë°©í™”ë²½ ë“± ë³´ì•ˆ ì„¤ì •ì´ ì¶”ê°€ë¡œ í•„ìš”í•˜ë‹¤.</li>
</ul>

<h3 id="2-nodeport-ë°©ì‹-1">2. NodePort ë°©ì‹</h3>

<blockquote>
  <p>NodePort ë°©ì‹ì˜ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬íŠ¸ë¥¼ ì§ì ‘ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¤ëŠ” ë°©ì‹</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ vim kubernetes-dashboard.yaml</span>

<span class="nn">---</span>

<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span> <span class="c1"># ì¶”ê°€</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">9090</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9090</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>

<span class="nn">---</span>
</code></pre></div></div>

<p>Service typeì„ NodePortë¡œ ë³€ê²½</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get svc <span class="nt">-n</span> kubernetes-dashboard
kubernetes-dashboard	NodePort	10.109.190.106	&lt;none&gt;	443:31384/TCP	28s

<span class="c"># master ip í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info
</code></pre></div></div>

<p>NodePort ì„¤ì • í™•ì¸</p>

<p>31384 í¬íŠ¸ë¡œ ì™¸ë¶€ì— ì˜¤í”ˆë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">https://master-ip:31384</code>ë¡œ ì ‘ì† í™•ì¸</p>

<h4 id="ë‹¨ì -1">ë‹¨ì </h4>

<ul>
  <li>Hostê°€ ì™¸ë¶€ì™€ ì§ì ‘ ì—°ê²°ë˜ëŠ” í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ëŒ€ì‹œë³´ë“œëŠ” https ì—°ê²°ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ë¯€ë¡œ ì¸ì¦ì„œê°€ ì—†ì–´ ì ‘ì† ë¶ˆê°€</li>
</ul>

<h3 id="3-api-server-ë°©ì‹-1">3. API Server ë°©ì‹</h3>

<blockquote>
  <p>ìœ„ì˜ Proxy ë°©ì‹ê³¼ ë¹„ìŠ·í•˜ë‚˜ API ì„œë²„ê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì–´ ìˆì–´ API ì„œë²„ì— ì§ì ‘ ì ‘ì†í•˜ëŠ” ë°©ì‹</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-k</span> <span class="nt">-v</span> https://&lt;master-ip&gt;:&lt;apiserver-port&gt;/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre></div></div>

<p>ì´ ê²½ìš° kubernetes dashboard ì¸ì¦ì„œë¥¼ ë¸Œë¼ìš°ì € ìì²´ì— ë”°ë¡œ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•˜ëŠ” ì¶”ê°€ ì‘ì—…ì´ ì¡´ì¬í•œë‹¤. (ë³¸ ë¬¸ì„œì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤.)</p>

<h4 id="ë‹¨ì -2">ë‹¨ì </h4>

<ul>
  <li>Hostê°€ ì™¸ë¶€ì™€ ì§ì ‘ ì—°ê²°ë˜ëŠ” í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li>
  <li>Kubernetes ê´€ë¦¬ìê°€ ì•„ë‹Œ ì‚¬ìš©ìê°€ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¸ì¦ì„œë¥¼ ì„¤ì¹˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.</li>
</ul>

<h3 id="4-ingress-ë°©ì‹-1">4. Ingress ë°©ì‹</h3>

<blockquote>
  <p>Kubernetes serviceë¥¼ ì™¸ë¶€ì™€ ì—°ê²°ì‹œì¼œì£¼ëŠ” Ingressë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹</p>
</blockquote>

<h4 id="ì„ í–‰ì‚¬í•­">ì„ í–‰ì‚¬í•­</h4>

<ul>
  <li>Ingress Controller ì„¤ì¹˜</li>
  <li>ë„ë©”ì¸ ì—°ê²° ë° SSL ì¸ì¦ì„œ ë°œê¸‰</li>
</ul>

<p>kubernetes-dashboardëŠ” https ìš”ì²­ì„ ê°•ì œí•˜ì§€ë§Œ ì™¸ë¶€ì—ì„œ Ingress Controllerë¡œ ë“¤ì–´ì˜¤ëŠ” ë¶€ë¶„ì´</p>

<p>TLS ì¸ì¦ ì²˜ë¦¬ê°€ ë˜ì–´ ìˆìœ¼ë¯€ë¡œ kubernetes ë‚´ë¶€ì—ì„œ ë™ì‘í•˜ëŠ” dashboard ì„œë¹„ìŠ¤ ë° podëŠ” httpë¥¼ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.</p>

<h4 id="1-kubernetes-dashboardyaml-ìˆ˜ì •">1. <code class="language-plaintext highlighter-rouge">kubernetes-dashboard.yaml</code> ìˆ˜ì •</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ vim kubernetes-dashboard.yaml</span>
<span class="nn">...</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="s">9090</span><span class="err">			</span><span class="s"># í¬íŠ¸ ìˆ˜ì •</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">9090</span><span class="err">		</span><span class="s"># í¬íŠ¸ ìˆ˜ì •</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="nn">---</span>

<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">spec</span><span class="err">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">kubernetesui/dashboard:v2.2.0</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9090</span> <span class="c1"># í¬íŠ¸ ìˆ˜ì •</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">args</span><span class="pi">:</span>
            <span class="c1">#- --auto-generate-certificates ì£¼ì„ ì²˜ë¦¬</span>
            <span class="pi">-</span> <span class="s">--namespace=kubernetes-dashboard</span>
            <span class="pi">-</span> <span class="s">--insecure-bind-address=0.0.0.0</span> <span class="c1"># ì¶”ê°€</span>
            <span class="pi">-</span> <span class="s">--enable-insecure-login</span> <span class="c1"># ì¶”ê°€</span>
            <span class="pi">-</span> <span class="s">--token-ttl=10800</span><span class="err">	</span><span class="s"># í† í° ì„¸ì…˜ ìœ ì§€ì‹œê°„(ì„ íƒ)</span>
            <span class="c1"># Uncomment the following line to manually specify Kubernetes API server Host</span>
            <span class="c1"># If not specified, Dashboard will attempt to auto discover the API server and connect</span>
            <span class="c1"># to it. Uncomment only if the default does not work.</span>
            <span class="c1"># - --apiserver-host=http://my-address:port</span>
            <span class="s">...</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTP</span> <span class="c1"># HTTPë¡œ ë³€ê²½</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="m">9090</span> <span class="c1"># í¬íŠ¸ ìˆ˜ì •</span>
            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
            <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">30</span>
<span class="nn">...</span>

<span class="s">$ kubectl apply -f kubernetes-dashboard.yaml</span>
</code></pre></div></div>

<h5 id="ì°¸ê³ ">ì°¸ê³ </h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--namespace=kubernetes-dashboard</code>: namespace ì„¤ì •</li>
  <li><code class="language-plaintext highlighter-rouge">--insecure-bind-address=0.0.0.0</code>: http ëª¨ë“  IP ì ‘ì† í—ˆìš©</li>
  <li><code class="language-plaintext highlighter-rouge">--enbale-insecure-login</code>: http ì ‘ì† í—ˆìš©</li>
</ul>

<h4 id="2-kubernetes-dashboard-ingressyaml-ìƒì„±">2. <code class="language-plaintext highlighter-rouge">kubernetes-dashboard-ingress.yaml</code> ìƒì„±</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span> <span class="c1"># kong ingressì˜ ê²½ìš° kong</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
      <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/"</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">9090</span>

<span class="s">$ kubectl apply -f kubernetes-dashboard-ingress.yaml</span>
</code></pre></div></div>

<h4 id="3-ì ‘ì†-í™•ì¸">3. ì ‘ì† í™•ì¸</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ingress Controller ì™¸ë¶€ ë…¸ì¶œ í¬íŠ¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl get svc <span class="nt">-n</span> ingress-ngninx
ingress-nginx-controller             NodePort    10.104.33.237   &lt;none&gt;        80:31623/TCP,443:32452/TCP   5h
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">http://external-ip:31623/</code> ì ‘ì†
(ë°©í™”ë²½ í¬íŠ¸í¬ì›Œë”© ëœ ê²½ìš° í•´ë‹¹ í¬íŠ¸ë¡œ ì ‘ì†)</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard1.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard1.png" alt="dashboard1.png" /></a></p>

<p>httpë¥¼ ì´ìš©í•˜ì—¬ ì ‘ì†í• ì‹œ ë¡œê·¸ì¸ì´ ë¹„í™œì„±í™” ëœë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">https://external-ip:32452/</code> ì ‘ì†
(ë°©í™”ë²½ í¬íŠ¸í¬ì›Œë”© ëœ ê²½ìš° í•´ë‹¹ í¬íŠ¸ë¡œ ì ‘ì†)</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard2.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard2.png" alt="dashboard2.png" /></a></p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard3.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard3.png" alt="dashboard3.png" /></a></p>

<p>httpsë¥¼ ì´ìš©í•˜ì—¬ ì ‘ì†ì‹œ ë¡œê·¸ì¸ì€ í™œì„±í™” ë˜ì§€ë§Œ ì¸ì¦ì„œ ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•Šë‹¤ê³  ë‚˜ì˜¨ë‹¤.</p>

<p>ì´ì œ SSL ì¸ì¦ì„œë¥¼ ì„œë²„ Ingressì— ì ìš©í•  ì°¨ë¡€ì´ë‹¤.</p>

<h4 id="4-kubernetes-secret-ìƒì„±">4. Kubernetes secret ìƒì„±</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kubectl create secret {secretType} {secretName} --namespace={namespace} --cert={certPath} --key={keyPath}</span>
<span class="nv">$ </span>kubectl create secret tls secret-tls <span class="nt">--namespace</span><span class="o">=</span>kubernetes-dashboard <span class="nt">--cert</span><span class="o">=</span>ssl/ccpinfra.xyz.crt <span class="nt">--key</span><span class="o">=</span>ssl/ccpinfra.xyz.key

<span class="c"># ìƒì„± í™•ì¸</span>
<span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> kubernetes-dashboard
<span class="nv">$ </span>kubectl describe secret secret-tls <span class="nt">-n</span> kubernetes-dashboard
</code></pre></div></div>

<p>ssl ì¸ì¦ì„œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” kubernetes secretì„ ìƒì„±í•œë‹¤.</p>

<p>ì´ ë•Œ, namespaceëŠ” Podì˜ namespaceì™€ ë™ì¼í•´ì•¼í•˜ë¯€ë¡œ ì„¤ì •í•´ì¤€ë‹¤.</p>

<p>ì°¸ê³ ) master ì„œë²„ nas ê²½ë¡œ <code class="language-plaintext highlighter-rouge">/mnt/certs</code>ì— ì¸ì¦ì„œ ìˆìŒ</p>

<h4 id="5-kubernetes-dashboard-ingressyaml-ìˆ˜ì •">5. <code class="language-plaintext highlighter-rouge">kubernetes-dashboard-ingress.yaml</code> ìˆ˜ì •</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ vim kubernetes-dashboard-ingress.yaml</span>

<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># ì•„ë˜ tls ë¶€ë¶„ ì¶”ê°€</span>
  <span class="na">tls</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">k8sdash.ccpinfra.xyz</span>
    <span class="na">secretName</span><span class="pi">:</span> <span class="s">secret-tls</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">k8sdash.ccpinfra.xyz</span> <span class="c1"># host ë„ë©”ì¸ ì¶”ê°€</span>
    <span class="na">http</span><span class="pi">:</span>
      <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/"</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">kubernetes-dashboard</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">9090</span>
              
<span class="s">$ kubectl apply -f kubernetes-dashboard-ingress.yaml</span>
</code></pre></div></div>

<h4 id="6-https-ì ‘ì†-ë°-ì¸ì¦ì„œ-í™•ì¸">6. HTTPS ì ‘ì† ë° ì¸ì¦ì„œ í™•ì¸</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ingress Controller ì™¸ë¶€ ë…¸ì¶œ í¬íŠ¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl get svc <span class="nt">-n</span> ingress-ngninx
ingress-nginx-controller             NodePort    10.104.33.237   &lt;none&gt;        80:31623/TCP,443:32452/TCP   5h
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">https://external-ip:32452/</code> ì ‘ì†
(ë°©í™”ë²½ í¬íŠ¸í¬ì›Œë”© ëœ ê²½ìš° í•´ë‹¹ í¬íŠ¸ë¡œ ì ‘ì†)</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard4.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard4.png" alt="dashboard4.png" /></a></p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard5.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard5.png" alt="dashboard5.png" /></a></p>

<p>ì¸ì¦ì„œ ì ìš© í™•ì¸</p>

<h4 id="7-ë² ì–´ëŸ¬-í† í°-ë°œê¸‰">7. ë² ì–´ëŸ¬ í† í° ë°œê¸‰</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í† í° ë°œê¸‰</span>
<span class="nv">$ </span>kubectl <span class="nt">-n</span> kubernetes-dashboard get secret <span class="si">$(</span>kubectl <span class="nt">-n</span> kubernetes-dashboard get sa/admin-user <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.secrets[0].name}"</span><span class="si">)</span> <span class="nt">-o</span> go-template<span class="o">=</span><span class="s2">""</span> <span class="o">&gt;&gt;</span> token

<span class="c"># í† í° í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>token
</code></pre></div></div>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard3.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard3.png" alt="dashboard3.png" /></a></p>

<p>ë¡œê·¸ì¸ í™”ë©´ì—ì„œ Token ì…ë ¥ í›„ ë¡œê·¸ì¸</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard6.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard6.png" alt="dashboard6.png" /></a></p>

<p>ë¡œê·¸ì¸ í™•ì¸</p>

<hr />

<h2 id="metric-server-ì„¤ì¹˜">Metric-server ì„¤ì¹˜</h2>
<p>ê° ì„œë²„ì—ì„œ cpu, memory metricì„ ê°€ì ¸ì™€ dashboardì—ì„œ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì£¼ë ¤ë©´ ì„¤ì¹˜í•´ì•¼í•œë‹¤.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</code></pre></div></div>

<p>metrics-server error because it doesnâ€™t contain any IP SANs ì—ëŸ¬ ë°œìƒí•  ê²½ìš°</p>
<ul>
  <li>deploymentì— ì•„ë˜ë¥¼ ì¶”ê°€í•œë‹¤.
```</li>
  <li>args:
     - â€“kubelet-insecure-tls
```</li>
</ul>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="1-404-page-not-found">1. 404 page not found</h3>
<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/dashboard7.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-03/scaled-1680-/dashboard7.png" alt="dashboard7.png" /></a></p>

<p>ìœ„ì™€ ê°™ì´ 404 page not foundê°€ ë‚˜ì˜¤ëŠ” ê²½ìš°</p>

<p>Ingressì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°ë¡œ ê²½ë¡œ ì„¤ì •ì„ ì˜ í™•ì¸í•´ë³¸ë‹¤.</p>

<p>ì‘ì„±ìì˜ ê²½ìš° ingress Path ì„¤ì •ì„ <code class="language-plaintext highlighter-rouge">"/"</code>ê°€ ì•„ë‹ˆë¼ <code class="language-plaintext highlighter-rouge">"/dashboard"</code>ë¡œ í•´ë†“ì•˜ì—ˆëŠ”ë° root pathê°€ ì•„ë‹ˆë©´ ì ìš©ì´ ë˜ì§€ ì•ŠëŠ” ë²„ê·¸ê°€ ì¡´ì¬í•˜ì˜€ë‹¤.</p>

<h3 id="2-kubernetes-dashboard-podê°€-ìê¾¸-ì£½ì–´ì„œ-ì¬ì‹œì‘ë˜ëŠ”-ê²½ìš°">2. kubernetes-dashboard podê°€ ìê¾¸ ì£½ì–´ì„œ ì¬ì‹œì‘ë˜ëŠ” ê²½ìš°</h3>

<p>ìœ„ì—ì„œ ëŒ€ì‹œë³´ë“œê°€ http í”„ë¡œí† ì½œë¡œ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•œ ë¶€ë¶„ì— ëˆ„ë½ë˜ê±°ë‚˜ ì˜ëª» ì„¤ì •í•œ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸</p>

<p>ì‘ì„±ìì˜ ê²½ìš° deploymentìª½ì˜ Liveness probe ì„¤ì •ì— httpê°€ ì•„ë‹Œ httpsë¡œ ë˜ì–´ ìˆì–´ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.</p>

<hr />

<h2 id="reference">Reference</h2>

<ol>
  <li><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Using RBAC Authorization</a></li>
  <li><a href="https://kubernetes.io/docs/reference/access-authn-authz/node/">Using Node Authorization</a></li>
  <li><a href="https://kubernetes.io/docs/reference/access-authn-authz/node/">Using ABAC Authorization</a></li>
  <li><a href="https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/">Certified Kubernetes Administrator(CKA) with Practice Tests</a></li>
</ol>
:ET