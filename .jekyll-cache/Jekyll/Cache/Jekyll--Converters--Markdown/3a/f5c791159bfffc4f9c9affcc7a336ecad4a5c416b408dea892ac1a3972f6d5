I"Òf<h1 id="sonarqube-ì„¤ì •-ë°-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…">SonarQube ì„¤ì • ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</h1>

<p><img src="/assets/img/titles/sonarqube.png" alt="sonarqube.png" /></p>

<p><a href="https://docs.sonarqube.org/latest/">SonarQube Documentation</a></p>

<p>ë³¸ ë¬¸ì„œì—ì„œëŠ” Sonarqube Jenkins ì—°ë™, GitLab ì—°ë™, Ingress ì¸ì¦ì„œ ì„¤ì •, ì›¹í›… ì„¤ì • ë“± ë‚´ìš©ì„ ëª¨ì•„ ì •ë¦¬í•˜ì˜€ìœ¼ë©°</p>

<p>ì„¤ì •ì‹œ ì˜¤ë¥˜ë¥¼ í•´ê²°í–ˆë˜ ë‚´ì—­ì„(íŠ¸ëŸ¬ë¸”ìŠˆíŒ…) ì •ë¦¬í•˜ì˜€ë‹¤.</p>

<hr />

<h2 id="sonarqube-ì„¤ì •">SonarQube ì„¤ì •</h2>

<h3 id="sonarqube-ingress-ssl-ì¸ì¦ì„œ-ì ìš©">SonarQube Ingress SSL ì¸ì¦ì„œ ì ìš©</h3>
<h4 id="1-k8s-secret-ìƒì„±">1. k8s Secret ìƒì„±</h4>

<blockquote>
  <p>k8s secret ìƒì„±ì€ <a href="/2021/04/03/kubernetes-ingress.html">Kubernetes Nginx Ingress ì ìš©</a> ì°¸ê³ </p>
</blockquote>

<h4 id="2-ingress-ë¦¬ì†ŒìŠ¤-ì„¤ì •">2. Ingress ë¦¬ì†ŒìŠ¤ ì„¤ì •</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim sonarqube-ingress.yaml
</code></pre></div></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
 <span class="s">metadata</span><span class="err">:</span>
   <span class="na">name</span><span class="pi">:</span> <span class="s">sonarqube</span>
   <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
   <span class="na">annotations</span><span class="pi">:</span>
     <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span>
     <span class="na">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
     <span class="na">nginx.ingress.kubernetes.io/force-ssl-redirect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
     <span class="na">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20M"</span><span class="err">		</span><span class="s">// 20M ì´ˆê³¼ì‹œ HTTP 413 ë°©ì§€í•˜ê¸° ìœ„í•˜ì—¬</span>
 <span class="na">spec</span><span class="pi">:</span>
   <span class="na">rules</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">sonarqube.ccpinfra.xyz</span> <span class="c1"># ì¶”ê°€</span>
     <span class="na">http</span><span class="pi">:</span><span class="err">	</span><span class="c1"># -(í•˜ì´í”ˆ) ì œê±°</span>
       <span class="na">paths</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
         <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/sonarqube"</span>
         <span class="na">backend</span><span class="pi">:</span>
           <span class="na">service</span><span class="pi">:</span>
             <span class="na">name</span><span class="pi">:</span> <span class="s">sonarqube-sonarqube</span>
             <span class="na">port</span><span class="pi">:</span>
               <span class="na">number</span><span class="pi">:</span> <span class="m">9000</span>
   <span class="na">tls</span><span class="pi">:</span><span class="err">	</span><span class="c1"># tls ì´í•˜ ë¶€ë¶„ ëª¨ë‘ ì¶”ê°€</span>
   <span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">sonarqube.yourdomain.com</span> <span class="c1"># ë“±ë¡í•œ ë„ë©”ì¸ëª… ì…ë ¥</span>
     <span class="na">secretName</span><span class="pi">:</span> <span class="s">secret-tls</span> <span class="c1"># k8s secret ë¦¬ì†ŒìŠ¤ëª… ì…ë ¥</span>
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> sonarqube-ingress.yaml
</code></pre></div></div>

<blockquote>
  <p>Nginx Ingress Controller ì‚¬ìš©í•˜ì˜€ë‹¤.
Ingress HTTP, HTTPS(/sonarqube) -&gt; sonarqube ì„œë¹„ìŠ¤(9000)</p>

  <blockquote>
    <p>tls ì„¤ì •ì— ë„ë©”ì¸ ì…ë ¥ì‹œ IP ì£¼ì†Œë¡œëŠ” Ingress ë™ì‘í•˜ì§€ ì•ŠìŒ</p>
  </blockquote>
</blockquote>

<h4 id="3-ì¸ì¦ì„œ-ì ìš©-í™•ì¸">3. ì¸ì¦ì„œ ì ìš© í™•ì¸</h4>

<p><img src="/assets/img/contents/sc-1.png" alt="sc-1.png" /></p>

<p>ë„ë©”ì¸ ì ‘ì† ë° í™•ì¸</p>

<blockquote>
  <p>Jenkinsì˜ SonarQube Server ì„¤ì • ê°’ì— ê¸°ì¡´ì˜ IPì£¼ì†Œë¡œ ë˜ì–´ìˆëŠ” ê²½ìš° ë„ë©”ì¸ ì£¼ì†Œë¡œ ë³€ê²½ í•„ìš”(http)</p>
</blockquote>

<hr />
<h3 id="jenkins-webhook-ì„¤ì •">Jenkins Webhook ì„¤ì •</h3>

<p>SonarQubeê°€ ê²€ì‚¬ë¥¼ ëë‚¸ ë’¤ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•˜ì—¬ SonarQubeì— Jenkinsë¡œì˜ Webhookì´ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼í•¨</p>

<p><img src="/assets/img/contents/sc-2.png" alt="sc-2.png" /></p>

<h4 id="1-sonarqube-ëŒ€ì‹œë³´ë“œ-ë¡œê·¸ì¸">1. SonarQube ëŒ€ì‹œë³´ë“œ ë¡œê·¸ì¸</h4>

<h4 id="2-administration--configuration--webhooks">2. Administration &gt; Configuration &gt; Webhooks</h4>

<h4 id="3-create">3. Create</h4>

<ul>
  <li>Name: ì›í•˜ëŠ” ì´ë¦„(<code class="language-plaintext highlighter-rouge">jenkins-webhook</code>)</li>
  <li>URL: jenkins ì£¼ì†Œ (http ì‚¬ìš©í•  ê²ƒ)</li>
  <li>Secret: (ì„ íƒ)</li>
</ul>

<h4 id="4-ë¹Œë“œì‹œ-ì›¹í›…-ë™ì‘-ì—¬ë¶€ë¥¼-ì´-í˜ì´ì§€ì—ì„œ-ì‹¤ì‹œê°„ìœ¼ë¡œ-í™•ì¸-ê°€ëŠ¥">4. ë¹Œë“œì‹œ ì›¹í›… ë™ì‘ ì—¬ë¶€ë¥¼ ì´ í˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥</h4>

<hr />
<h3 id="jenkins-íŒŒì´í”„ë¼ì¸---javascript-typescript-ì—°ë™">Jenkins íŒŒì´í”„ë¼ì¸ - JavaScript, TypeScript ì—°ë™</h3>

<p>JavaScriptëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì € ìœ„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ì¸ NodeJSê°€ ì  í‚¨ìŠ¤ì— í•„ìš”í•˜ë‹¤.</p>

<h4 id="1-nodejs-í”ŒëŸ¬ê·¸ì¸-ì„¤ì¹˜">1. NodeJS í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</h4>

<ol>
  <li>Jenkins ê´€ë¦¬ &gt; í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ &gt; ì„¤ì¹˜ê°€ëŠ¥ &gt; nodejs ê²€ìƒ‰</li>
  <li>ì¬ì‹œì‘ ì—†ì´ ì„¤ì¹˜í•˜ê¸°(ì—…ë°ì´íŠ¸, ë””íœë˜ì‹œ ì¶”ê°€ ë“±ìœ¼ë¡œ ì¬ì‹œì‘ í•„ìš”ì‹œ ì¬ì‹œì‘ í›„ ì„¤ì¹˜í•˜ê¸°)</li>
</ol>

<p><img src="/assets/img/contents/sc-3.png" alt="sc-3.png" /></p>

<h4 id="2-nodejs-tools-ì„¤ì •">2. NodeJS Tools ì„¤ì •</h4>

<ol>
  <li>Jenkins ê´€ë¦¬ &gt; Global Tool Configuration</li>
  <li>NodeJS &gt; NodeJS installationsâ€¦</li>
  <li>nodejs installer ì •ë³´ ì…ë ¥
    <ul>
      <li>Name: ì›í•˜ëŠ” ì´ë¦„(nodejs)</li>
      <li>Install automatically: ì²´í¬</li>
      <li>Install from nodejs.org</li>
      <li>Version: NodeJS 14.17.0 (ì›í•˜ëŠ” ë²„ì „ but latest LTS ë²„ì „ì¸ 14ë²„ì „ ê¶Œì¥)</li>
    </ul>
  </li>
  <li>ì €ì¥</li>
</ol>

<h4 id="3-ì ìš©í• -pipelineì—-nodejs-tool-í™˜ê²½-ì¶”ê°€">3. ì ìš©í•  pipelineì— nodejs tool í™˜ê²½ ì¶”ê°€</h4>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">node</span> <span class="o">(</span><span class="s1">'jenkins-slave'</span><span class="o">){</span>
    <span class="o">...</span>
    <span class="n">env</span><span class="o">.</span><span class="na">NODEJS_HOME</span> <span class="o">=</span> <span class="s2">"${tool 'nodejs'}"</span>	<span class="c1">// 2-3 í•­ëª©ì—ì„œ ì…ë ¥í•œ nodejs installer ì´ë¦„</span>
    <span class="n">env</span><span class="o">.</span><span class="na">PATH</span><span class="o">=</span><span class="s2">"${env.NODEJS_HOME}/bin:${env.PATH}"</span>
    <span class="n">sh</span> <span class="s1">'npm --version'</span>
    <span class="o">...</span>
</code></pre></div></div>
<p>ìœ„ì™€ê°™ì´ ì„¤ì •í•´ì£¼ë©´ jenkins-slaveì—ì„œ <code class="language-plaintext highlighter-rouge">node</code>, <code class="language-plaintext highlighter-rouge">npm</code> ëª…ë ¹ì–´ ì‚¬ìš© ê°€ëŠ¥</p>

<h4 id="4-sonar-property-ì¶”ê°€">4. sonar property ì¶”ê°€</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sonarqube {
       properties {
                property "sonar.sources", "src/main"
                property "sonar.tests", "src/test"
       }
}
</code></pre></div></div>
<blockquote>
  <p>ìœ„ ì½”ë“œëŠ” gradle í”„ë¡œì íŠ¸ build.gradle íŒŒì¼ ê¸°ì¤€</p>
</blockquote>

<p>ì†Œë‚˜íë¸Œ ê²€ì¦ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ java ê²½ë¡œë§Œ ì¡ëŠ” ê²½ìš°</p>

<p><code class="language-plaintext highlighter-rouge">sonar.sources = src/main</code>, <code class="language-plaintext highlighter-rouge">sonar.tests = src/test</code> ë“±ìœ¼ë¡œ ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì–´ì•¼ JS ì½”ë“œë„ ê²€ì‚¬ ê°€ëŠ¥</p>

<hr />
<h3 id="sonarqube-for-maven-ì„¤ì •">SonarQube for Maven ì„¤ì •</h3>

<p>Mavenì˜ ê²½ìš° ì„¤ì¹˜í˜•ì´ê¸° ë•Œë¬¸ì— ë³„ë„ë¡œ dependency ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.</p>

<p>sonar-maven-pluginì„ ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì™€ì„œ ë°”ë¡œ ì‹¤í–‰í•œë‹¤.</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">stage</span><span class="o">(</span><span class="s2">"SonarQube analysis"</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">withSonarQubeEnv</span><span class="o">(</span><span class="s1">'sonarqube server'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sh</span> <span class="s1">'mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.9.0.2155:sonar'</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">stage</span><span class="o">(</span><span class="s2">"Quality Gate"</span><span class="o">){</span>
        <span class="n">timeout</span><span class="o">(</span><span class="nl">time:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">unit:</span> <span class="s1">'HOURS'</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">qg</span> <span class="o">=</span> <span class="n">waitForQualityGate</span><span class="o">()</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">qg</span><span class="o">.</span><span class="na">status</span> <span class="o">!=</span> <span class="s1">'OK'</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">error</span> <span class="s2">"Pipeline aborted due to quality gate failure: ${qg.status}"</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<hr />
<h3 id="sonarqube-for-gradle-ì„¤ì •">SonarQube for Gradle ì„¤ì •</h3>

<p>Gradle í”„ë¡œì íŠ¸ì˜ ê²½ìš° ë³´í†µ gradlewì˜ wrapper í˜•íƒœë¡œ ì œê³µë˜ëŠ” ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì´ë‹¤.</p>

<p>ë”°ë¼ì„œ sonarqube í”ŒëŸ¬ê·¸ì¸ì„ í”„ë¡œì íŠ¸ì˜ build.gradle dependencyì— ì¶”ê°€í•´ì£¼ì–´ì•¼í•œë‹¤.</p>

<p>ì•„ë˜ ë¶€ë¶„ í”„ë¡œì íŠ¸ì˜ build.gradleì— ì¶”ê°€</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="n">plugin</span> <span class="err">ë¶€ë¶„</span> <span class="err">ì¶”ê°€</span>
	<span class="n">plugin</span> <span class="o">{</span>
    	<span class="n">id</span> <span class="s1">'org.sonarqube'</span> <span class="n">version</span> <span class="s1">'3.0'</span>
    <span class="o">}</span>
<span class="err">#</span> <span class="err">ë˜ëŠ”</span>
    <span class="n">buildscript</span> <span class="o">{</span>
        <span class="n">repositories</span> <span class="o">{</span>
            <span class="n">jcenter</span><span class="o">()</span>
        <span class="o">}</span>
        <span class="n">dependencies</span> <span class="o">{</span>
            <span class="n">classpath</span><span class="o">(</span><span class="s2">"org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:3.0"</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'org.sonarqube'</span>


<span class="err">#</span> <span class="n">repository</span> <span class="err">ì¶”ê°€</span>
	<span class="n">repositories</span> <span class="o">{</span>   	
		<span class="n">jcenter</span><span class="o">()</span>
	<span class="o">}</span>
    
<span class="err">#</span> <span class="n">sonarqube</span> <span class="err">í”„ë¡œí¼í‹°</span> <span class="err">ì¶”ê°€</span>
    <span class="n">sonarqube</span> <span class="o">{</span>
		<span class="n">properties</span> <span class="o">{</span>
			<span class="n">property</span> <span class="s2">"sonar.sources"</span><span class="o">,</span> <span class="s2">"src/main"</span>
		<span class="o">}</span>
	<span class="o">}</span>
    
<span class="err">#</span> <span class="n">multi</span> <span class="n">module</span> <span class="n">project</span><span class="err">ì˜</span> <span class="err">ê²½ìš°</span>
<span class="err">#</span> <span class="err">ì•„ë˜ì™€</span> <span class="err">ê°™ì´</span> <span class="err">ê²€ì‚¬í• </span> <span class="err">ëª¨ë“ˆëª…</span> <span class="err">ëª…ì‹œ</span> <span class="err">í›„</span> <span class="err">ì•ˆì—</span> <span class="err">ì ìš©</span>
<span class="n">project</span><span class="o">(</span><span class="s2">":makers-web"</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'org.sonarqube'</span>

	<span class="n">sonarqube</span> <span class="o">{</span>
		<span class="n">properties</span> <span class="o">{</span>
			<span class="n">property</span> <span class="s2">"sonar.sources"</span><span class="o">,</span> <span class="s2">"src/main"</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
<span class="err">#</span> <span class="err">ë˜ëŠ”</span> <span class="err">ì „ì²´</span> <span class="err">ì ìš©ì‹œ</span>
<span class="n">subprojects</span> <span class="o">{</span>
	<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'org.sonarqube'</span>

	<span class="n">sonarqube</span> <span class="o">{</span>
		<span class="n">properties</span> <span class="o">{</span>
			<span class="n">property</span> <span class="s2">"sonar.sources"</span><span class="o">,</span> <span class="s2">"src/main"</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>ë¹Œë“œì‹œ sonarqube gradle plugin ë‹¤ìš´ë¡œë“œ ë° ê²€ì‚¬ í™•ì¸</p>

<hr />
<h3 id="sonarqube-quality-profiles-ì ìš©">SonarQube Quality Profiles ì ìš©</h3>

<p>ê¸°ë³¸ì ìœ¼ë¡œ ê° ì–¸ì–´ë³„ Sonar wayë¼ëŠ” Default Profileì´ ì ìš©ë˜ì–´ ìˆìŒ</p>

<p><img src="/assets/img/contents/sc-4.png" alt="sc-4.png" /></p>

<ol>
  <li>sonarqube ëŒ€ì‹œë³´ë“œ ë¡œê·¸ì¸</li>
  <li>(ì„ íƒ) Quality Profiles &gt; Create ë˜ëŠ” Java Sonar way í”„ë¡œí•„ ì„¤ì • &gt; Copy
    <ul>
      <li>Name: ì›í•˜ëŠ” ì´ë¦„</li>
      <li>Language: ì›í•˜ëŠ” ì–¸ì–´</li>
      <li>Parent: none</li>
    </ul>
  </li>
  <li>ìƒˆë¡œ ìƒì„±í•œ Profile ì„¤ì • &gt; Set as Default</li>
  <li>ì„¤ì • &gt; Activate More Rulesì—ì„œ ì¶”ê°€ë¡œ ì ìš©í•  Rule íƒìƒ‰</li>
  <li>Activate í´ë¦­í•˜ì—¬ ì ìš©</li>
</ol>

<hr />
<h3 id="sonarqube-gitlab-ê³„ì •ê·¸ë£¹-ì—°ë™">SonarQube GitLab ê³„ì •/ê·¸ë£¹ ì—°ë™</h3>

<p>SonarQube ë¡œê·¸ì¸ì‹œ GitLab OAuth2ë¥¼ ì‚¬ìš©í•˜ì—¬ gitlab ê³„ì • ì—°ë™ì„ í•  ìˆ˜ ìˆë‹¤.</p>

<h4 id="1-gitlab-ì‚¬ì´ë“œ">1. GitLab ì‚¬ì´ë“œ</h4>
<ol>
  <li>GitLab OAuth2 Application ë“±ë¡
    <ol>
      <li>Admin Area &gt; Applications &gt; New application</li>
      <li>New application ì…ë ¥
        <ul>
          <li>Name: ì›í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ ì…ë ¥(GitLab SonarQube)</li>
          <li>Redirect URI: <code class="language-plaintext highlighter-rouge">${sonarqube-uri}/oauth2/callback/gitlab</code> ì…ë ¥ (public URLì´ì–´ì•¼í•œë‹¤.)</li>
          <li>Trusted: í˜„ì¬ ë“±ë¡í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹ ë¢°í•  ê²ƒì¸ì§€? ì²´í¬</li>
          <li>Confidential: Client Secretì„ ì•”í˜¸í™”í†µì‹ í•  ê²ƒì¸ì§€? ì²´í¬</li>
          <li>Scopes: api ì²´í¬(gitlab oauth2 api ì‚¬ìš©ê¶Œí•œ)</li>
        </ul>
      </li>
      <li>Submit í›„ ì•± ì •ë³´ í™•ì¸</li>
      <li>Application ID, Secret ë³µì‚¬</li>
    </ol>
  </li>
</ol>

<h4 id="2-sonarqube-ì‚¬ì´ë“œ">2. SonarQube ì‚¬ì´ë“œ</h4>

<p><img src="/assets/img/contents/sc-5.png" alt="sc-5.png" /></p>

<ol>
  <li>Server Base URL ì„¤ì •
    <ol>
      <li>Administration &gt; Configuration &gt; General Settings</li>
      <li>Server base URL ì…ë ¥
        <ul>
          <li>ì™¸ë¶€ ì—°ë™ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ public í†µì‹ ì´ê¸° ë•Œë¬¸ì— public url ì…ë ¥
            <ul>
              <li>https://sonarqube.yourdomain.com/sonarqube</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Save</li>
    </ol>
  </li>
  <li>ALM Integration ì„¤ì •
    <ol>
      <li>Administration &gt; Configuration &gt; ALM Integrations &gt; GitLab</li>
      <li>GitLab Authentication í•­ëª© ì…ë ¥
        <ul>
          <li>Enabled: true</li>
          <li>GitLab URL: public gitlab URL ì…ë ¥(<code class="language-plaintext highlighter-rouge">https://gitlab.yourdomain.com</code>)</li>
          <li>Application ID, Secret: 1-4ì—ì„œ ë³µì‚¬í•œ í•­ëª© ê°ê° ì…ë ¥</li>
          <li>Allow users to sign-up: gitlab oauth2ë¡œ ì²˜ìŒ ë¡œê·¸ì¸í•˜ëŠ” ì‚¬ìš©ìë¥¼ sonarqubeì— ë“±ë¡í•  ê²ƒì¸ì§€? ì²´í¬</li>
          <li>Synchronize user groups: ì†Œë‚˜íë¸Œì— gitlab ê·¸ë£¹ëª…ê³¼ ì¼ì¹˜í•˜ëŠ” ê·¸ë£¹ì´ ìƒì„±ë˜ì–´ ìˆë‹¤ë©´ ìœ ì €ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•œë‹¤. ì²´í¬</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <h4 id="java-cacerts-ì¸ì¦ì„œ-ì„¤ì •kubernetes-tls-secret">Java caCerts ì¸ì¦ì„œ ì„¤ì •(Kubernetes TLS Secret)</h4>

    <blockquote>
      <p>Javaì—ì„œëŠ” https í†µì‹ ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ java keystoreì— ì¸ì¦ì„œë¥¼ ìš”êµ¬í•œë‹¤.<br />ìœ„ì—ì„œ public ê²½ë¡œë¥¼ httpë¡œ ì„¤ì •í•˜ì˜€ìœ¼ë©´ ìƒê´€ ì—†ìœ¼ë‚˜ httpsë¡œ ì„¤ì •í•œ ê²½ìš° ì§„í–‰</p>

      <p>í˜„ì¬ Java ê¸°ë°˜ ì„œë¹„ìŠ¤ë“¤ì€ Kubernetes í™˜ê²½ì— ë– ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ í™˜ê²½ìœ¼ë¡œ ì§„í–‰</p>
      <ol>
        <li>ê¸°ì¡´ k8sì— <code class="language-plaintext highlighter-rouge">kubernetes.io/tls</code> íƒ€ì…ìœ¼ë¡œ ë– ìˆëŠ” tls íƒ€ì… ì‹œí¬ë¦¿ì€ ì‚¬ìš©ë¶ˆê°€í•˜ë¯€ë¡œ opaque íƒ€ì…(ê¸°ë³¸íƒ€ì…) secretì„ ìƒì„±í•œë‹¤.</li>
        <li>sonarqube-secret.yaml ìƒì„±
          <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 	<span class="nv">$ </span>vim sonarqube-secret.yaml
</code></pre></div>          </div>
          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sonarqube-secret</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">cert-1.crt</span><span class="pi">:</span> <span class="s">MIIFIzCC...</span> <span class="c1"># .crt(X.509 í¬ë§·)ì˜ ì¸ì¦ì„œê°’</span>
</code></pre></div>          </div>
          <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> sonarqube-secret.yaml
</code></pre></div>          </div>
        </li>
        <li>helm values.yaml ìˆ˜ì •
          <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim values.yaml
</code></pre></div>          </div>
          <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">...</span>
 <span class="na">caCerts</span><span class="pi">:</span>
   <span class="na">image</span><span class="pi">:</span> <span class="s">adoptopenjdk/openjdk11:alpine</span>
   <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
   <span class="na">secret</span><span class="pi">:</span> <span class="s">sonarqube-secret</span>
<span class="nn">...</span>
</code></pre></div>          </div>
          <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># helm upgrade</span>
<span class="nv">$ </span>helm upgrade sonarqube oteemocharts/sonarqube <span class="nt">-f</span> values.yaml
</code></pre></div>          </div>
        </li>
      </ol>
    </blockquote>
  </li>
  <li>
    <h4 id="í…ŒìŠ¤íŠ¸">í…ŒìŠ¤íŠ¸</h4>

    <ol>
      <li>ë¡œê·¸ì•„ì›ƒ í›„ ë©”ì¸í˜ì´ì§€ì— ë“¤ì–´ê°€ë©´ ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ Log in with GitLab ë²„íŠ¼ ìƒì„± í™•ì¸
 <img src="/assets/img/contents/sc-6.png" alt="sc-6.png" /></li>
      <li>ë²„íŠ¼ ëˆ„ë¥´ë©´ GitLabì— ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš° ìë™ìœ¼ë¡œ ì†Œë‚˜íë¸Œ ì‚¬ìš©ì ìƒì„± ë° ì—°ë™ì´ ì™„ë£Œëœë‹¤.</li>
      <li>gitlab ê·¸ë£¹ëª…ê³¼ ì¼ì¹˜í•˜ëŠ” ê·¸ë£¹ì„ ë¯¸ë¦¬ ìƒì„±í•´ ë†“ìœ¼ë©´ ë¡œê·¸ì¸ì‹œ í•´ë‹¹ ìœ ì € ê·¸ë£¹ ìë™ ì—°ë™</li>
    </ol>
  </li>
</ol>

<hr />
<h3 id="sonarqube-ë°°ì§€">SonarQube ë°°ì§€</h3>

<p><img src="/assets/img/contents/sc-7.png" alt="sc-7.png" /></p>

<p>ê° í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ &gt; ìš°ìƒë‹¨ Project Information</p>

<p>markdown í˜•íƒœë¡œ ì‹¤ì‹œê°„ ì •ë³´ ë°°ì§€ë¥¼ embed ê°€ëŠ¥</p>

<p>ëŒ€ì‹  í•´ë‹¹ ë°°ì§€ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ SonarQube í”„ë¡œì íŠ¸ê°€ Publicìœ¼ë¡œ ì„¤ì •ë˜ì–´ì•¼í•˜ë©° ì´ëŠ” ì†ŒìŠ¤ ì·¨ì•½ì ì„ ì™¸ë¶€ì—ì„œ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="1-ë¶„ì„-ê¶Œí•œ-ì—†ìŒ">1. ë¶„ì„ ê¶Œí•œ ì—†ìŒ</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>ERROR] Error during SonarScanner execution
<span class="o">[</span>ERROR] You<span class="s1">'re not authorized to run analysis. Please contact the project administrator.
</span></code></pre></div></div>

<p>ë¹Œë“œ í›„ ê²€ì¦ ìˆ˜í–‰ì‹œ ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë‚  ë•Œ</p>

<p>SonarQube í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ë° ì‹¤í–‰ì€ ì™„ë£Œë˜ì—ˆìœ¼ë‚˜ Jenkins - SonarQube ì—°ë™ ê³„ì •ì´ Analysis ì‹¤í–‰ ê¶Œí•œì´ ì—†ëŠ” ê²½ìš°ì´ë‹¤.</p>

<p><img src="/assets/img/contents/sc-8.png" alt="sc-8.png" /></p>

<ol>
  <li>SonarQube ëŒ€ì‹œë³´ë“œ ë¡œê·¸ì¸(ê´€ë¦¬ì ê³„ì • í•„ìš”)</li>
  <li>Administration &gt; Security &gt; Global Permissions</li>
  <li>ì—°ë™ëœ ìœ ì €ê°€ ì†í•œ ê·¸ë£¹ í˜¹ì€ ìœ ì € ìì²´ì— Execute Analysis ê¶Œí•œ ì²´í¬</li>
</ol>

<h3 id="2-class-íŒŒì¼-ì—†ìŒ">2. class íŒŒì¼ ì—†ìŒ</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>ERROR] Failed to execute goal org.sonarsource.scanner.maven:sonar-maven-plugin:3.7.0.1746:sonar <span class="o">(</span>default-cli<span class="o">)</span> on project sample-project: Your project contains .java files, please provide compiled classes with sonar.java.binaries property, or exclude them from the analysis with sonar.exclusions property. -&gt; <span class="o">[</span>Help 1]
</code></pre></div></div>

<p>pipeline ë˜ëŠ” job ì‹¤í–‰ ìˆœì„œì— ë¹Œë“œ ì´ì „ì— ë¶„ì„ì„ ì‹œë„í•˜ê³  ìˆëŠ”ì§€ ì²´í¬í•  ê²ƒ.</p>

<p>Javaì˜ ê²½ìš° sonarqubeëŠ” ì‹ ë¢°ë„ë¥¼ ë†’ì´ê¸° ìœ„í•˜ì—¬ .java íŒŒì¼ë§Œìœ¼ë¡œ ì½”ë“œ ë¶„ì„ì„ í•˜ì§€ ì•Šê³  .javaì™€ .class íŒŒì¼ì„ í•¨ê»˜ ë¶„ì„í•œë‹¤ê³  í•œë‹¤.</p>

<blockquote>
  <p><a href="https://docs.sonarqube.org/latest/analysis/languages/java/#header-2">https://docs.sonarqube.org/latest/analysis/languages/java/#header-2</a> ì°¸ì¡°</p>
</blockquote>

<p>ë”°ë¼ì„œ ì»´íŒŒì¼ëœ .class íŒŒì¼ì´ ìˆì–´ì•¼í•˜ë¯€ë¡œ maven ë˜ëŠ” gradle í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ì•¼í•¨.</p>

<p>ë§Œì•½ ì—†ì„ ê²½ìš°, ìˆ˜ë™ìœ¼ë¡œ ì»´íŒŒì¼í•˜ì—¬ .class íŒŒì¼ì„ ë„£ì–´ì¤˜ì•¼í•¨.</p>

<h3 id="3-ì†ŒìŠ¤-ë¶„ì„ì‹œ-http-413-request-entity-too-large">3. ì†ŒìŠ¤ ë¶„ì„ì‹œ HTTP 413 REQUEST ENTITY TOO LARGE</h3>

<p>ì†ŒìŠ¤ ë¶„ì„ì‹œ <code class="language-plaintext highlighter-rouge">HTTP 413 REQUEST ENTITY TOO LARGE</code>ê°€ ë‚˜ì˜¤ëŠ” ê²½ìš°</p>

<p>ê²€ì¦í•  ì†ŒìŠ¤ê°€ sonarqubeì˜ max body size(ê¸°ë³¸ê°’: 20m)ë¥¼ ì´ˆê³¼í•˜ì—¬ ë‚˜ì˜¤ëŠ” ê²½ìš°ë¡œ</p>

<p>ì•„ë˜ì™€ ê°™ì´ sonarqube-ingress.yamlì— proxy body size ì„¤ì •</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">...</span>
   <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
   <span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
    <span class="s">metadata</span><span class="err">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">sonarqube</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">kubernetes.io/ingress.class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span>
        <span class="na">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
        <span class="na">nginx.ingress.kubernetes.io/force-ssl-redirect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
        <span class="na">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20M"</span><span class="err">		</span><span class="s">// 20M ì´ˆê³¼ì‹œ HTTP 413 ë°©ì§€í•˜ê¸° ìœ„í•˜ì—¬</span>
<span class="nn">...</span>
</code></pre></div></div>

<hr />

<h2 id="reference">Reference</h2>

<ol>
  <li><a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner-for-jenkins/">SonarScanner for Jenkins</a></li>
  <li><a href="https://www.jenkins.io/doc/pipeline/steps/sonar/#sonarqube-scanner-for-jenkins">SonarQube Scanner for Jenkins</a></li>
  <li><a href="https://docs.sonarqube.org/latest/analysis/gitlab-integration/">SonarQube GitLab Integration</a></li>
</ol>
:ET