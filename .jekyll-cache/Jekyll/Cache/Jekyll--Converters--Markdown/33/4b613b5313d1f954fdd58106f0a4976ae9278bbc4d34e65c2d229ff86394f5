I"‘E<h1 id="lets-encrypt-ì¸ì¦ì„œ-ë°œê¸‰-ë°-ê°±ì‹ ">Letâ€™s Encrypt ì¸ì¦ì„œ ë°œê¸‰ ë° ê°±ì‹ </h1>

<p><img src="/assets/img/titles/letsencrypt-horizontal.png" alt="letsencrypt-horizontal.png" /></p>

<p><a href="https://letsencrypt.org/docs/">Letâ€™s Encrypt Docs</a></p>

<p>ë³¸ ë¬¸ì„œëŠ” ë¬´ë£Œ SSL ì¸ì¦ì„œë¥¼ ì œê³µí•˜ëŠ” Letâ€™s Encryptë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„œ ë°œê¸‰ ë° ê°±ì‹ ì„ í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•˜ì˜€ë‹¤.</p>

<hr />
<h2 id="ì‚¬ì „-ì¤€ë¹„-ì‚¬í•­">ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­</h2>

<ol>
  <li>SSL ì¸ì¦ì„œ ì ìš©ì„ ìœ„í•´ì„œëŠ” ë„ë©”ì¸ êµ¬ë§¤ í•„ìˆ˜</li>
  <li>êµ¬ì…í•œ ë„ë©”ì¸ê³¼ ì›¹ì„œë²„ ì—°ê²°: ê°€ë¹„ì•„ì™€ ê°™ì€ ë„ë©”ì¸ êµ¬ë§¤ ê¸°ê´€ì—ì„œ ì„¤ì • í•„ìš”</li>
  <li>root ìœ ì € ìƒíƒœë¡œ ê°€ì •í•˜ê³  ì§„í–‰</li>
</ol>

<p>ì¸ì¦ì„œ ë°œê¸‰ ë°©ë²•ì€ ìˆ˜ë™ìœ¼ë¡œ certbot ì„¤ì¹˜ í›„ ë°œê¸‰ ì§„í–‰ í•˜ëŠ” ë°©ë²•ê³¼ docker imageë¡œ ë°œê¸‰í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</p>

<hr />
<h2 id="docker-imageë¡œ-ì¸ì¦ì„œ-ë°œê¸‰-ë°©ë²•">docker imageë¡œ ì¸ì¦ì„œ ë°œê¸‰ ë°©ë²•</h2>
<p>docker volume pathì˜ mount ì§€ì ì— ì¸ì¦ì„œê°€ ìƒì„±ëœë‹¤.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--name</span> certbot <span class="nt">-v</span> <span class="s1">'/etc/letsencrypt:/etc/letsencrypt'</span> <span class="nt">-v</span> <span class="s1">'/var/lib/letsencrypt:/var/lib/letsencrypt'</span> certbot/certbot certonly <span class="nt">-d</span> <span class="k">*</span>.grigri.xyz <span class="nt">--manual</span> <span class="nt">--preferred-challenges</span> dns <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory
</code></pre></div></div>

<h2 id="certbot-ì„¤ì¹˜-í›„-ë°œê¸‰-ë°©ë²•">certbot ì„¤ì¹˜ í›„ ë°œê¸‰ ë°©ë²•</h2>

<blockquote>
  <p>Ubuntu 20.04 LTS ëŒ€ìƒ certbot ì„¤ì¹˜ ì‹œ ppa repoëŠ” deprecated ë¨.</p>

  <blockquote>
    <p>nginx + ubuntu 20.04 í™˜ê²½ ì‹œ certbot ì„¤ì¹˜ ë§¤ë‰´ì–¼ ì°¸ì¡°í•˜ì—¬ ì„¤ì¹˜ ì§„í–‰ ì°¸ê³ : https://certbot.eff.org/lets-encrypt/ubuntufocal-nginx</p>
  </blockquote>

</blockquote>

<p>Ubuntu 20.04 í™˜ê²½ì—ì„œ certbot ì„¤ì¹˜</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í•„ìš” ì‹œ snapd package ì„¤ì¹˜. </span>
<span class="c"># ubuntu 16.04 ë¶€í„° ê¸°ë³¸ ì„¤ì¹˜ ë˜ì–´ ìˆìŒ.(https://snapcraft.io/docs/installing-snap-on-ubuntu)</span>

<span class="c"># snap ìµœì‹ ìœ¼ë¡œ ì—…ë°ì´íŠ¸</span>
<span class="nv">$ </span><span class="nb">sudo </span>snap <span class="nb">install </span>core<span class="p">;</span> <span class="nb">sudo </span>snap refresh core

<span class="c"># ê¸°ì¡´ certbot ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get remove certbot

<span class="c"># certbot ì„¤ì¹˜</span>
<span class="nv">$ </span><span class="nb">sudo </span>snap <span class="nb">install</span> <span class="nt">--classic</span> certbot

<span class="c"># certbot ì‹¤í–‰íŒŒì¼ link ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">sudo ln</span> <span class="nt">-s</span> /snap/bin/certbot /usr/bin/certbot

<span class="c"># certbot ë²„ì „ í™•ì¸</span>
<span class="nv">$ </span>certbot <span class="nt">--version</span>
</code></pre></div></div>

<p>Ubuntu</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get update
<span class="nv">$ </span>apt-get <span class="nb">install </span>software-properties-common
<span class="nv">$ </span>add-apt-repository ppa:certbot/certbot
<span class="nv">$ </span>apt-get update
<span class="nv">$ </span>apt-get <span class="nb">install </span>certbot
</code></pre></div></div>

<p>CentOS</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>epel-release <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>certbot <span class="nt">-y</span>
</code></pre></div></div>

<p>Option) certbot ì›¹ì„œë¹„ìŠ¤ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># apach ì¸ ê²½ìš°</span>
<span class="nv">$ </span>apt-get <span class="nb">install </span>python-certbot-apach

<span class="c"># nginx ì¸ ê²½ìš°</span>
<span class="nv">$ </span>apt-get <span class="nb">install </span>python-certbot-nginx
</code></pre></div></div>

<hr />
<h2 id="ì¸ì¦ì„œ-ë°œê¸‰">ì¸ì¦ì„œ ë°œê¸‰</h2>

<ul>
  <li>webroot, standalone, dnsì˜ 3ê°€ì§€ ë°©ì‹ ì¤‘ dns ë°©ì‹ìœ¼ë¡œ ì„¤ì¹˜ ì§„í–‰</li>
  <li>DNS ë°©ì‹ ì¸ì¦ì„œëŠ” ì™€ì¼ë“œì¹´ë“œ url ì§€ì›í•˜ë¯€ë¡œ *.yourdomain.com í˜•ì‹ìœ¼ë¡œ ë°œê¸‰ ìš”ì²­</li>
  <li>certonly ì˜µì…˜ìœ¼ë¡œ ì¸ì¦ì„œë§Œ ë°œê¸‰ â†’ ì›¹ ì„œë¹„ìŠ¤ì˜ ì„¤ì • íŒŒì¼ ìë™ìœ¼ë¡œ ë³€ê²½í•˜ì§€ ì•ŠìŒ</li>
  <li>standalone ë°©ì‹ìœ¼ë¡œ ë°œê¸‰ ì‹œ web serivceë¥¼ ì ì‹œ ì¤‘ë‹¨í•´ì•¼ í•¨</li>
  <li>í•˜ë£¨ ë™ì•ˆ 3ë²ˆë§Œ ë°œê¸‰ ê°€ëŠ¥í•˜ë¯€ë¡œ ë°œê¸‰ ì‹œ ì£¼ì˜ í•„ìš”</li>
</ul>

<h3 id="manual-ì˜µì…˜ìœ¼ë¡œ-dns-ë°©ì‹-ì§€ì •">manual ì˜µì…˜ìœ¼ë¡œ dns ë°©ì‹ ì§€ì •</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dns ë°©ì‹ ì¸ì¦ì„œ ë°œê¸‰ </span>
<span class="nv">$ </span>certbot certonly <span class="nt">--manual</span> <span class="nt">--preferred-challenges</span> dns-01 <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory <span class="nt">--agree-tos</span> <span class="nt">-m</span> csupreme19@gmail.com <span class="nt">-d</span> <span class="k">*</span>.yourdomain.com
</code></pre></div></div>

<h4 id="dns-txt-ê°’-í‘œì‹œë˜ëŠ”-í™”ë©´ì—ì„œ-ì—”í„°-ëˆŒëŸ¬-ì§„í–‰í•˜ì§€-ì•Šê³ -ëŒ€ê¸°">DNS TXT ê°’ í‘œì‹œë˜ëŠ” í™”ë©´ì—ì„œ ì—”í„° ëˆŒëŸ¬ ì§„í–‰í•˜ì§€ ì•Šê³  ëŒ€ê¸°</h4>

<p>dns ë°©ì‹ ì¸ì¦ì„œ ë°œê¸‰ command ì…ë ¥ í›„ ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•Šê³  <strong>ëŒ€ê¸°</strong>í•œ í›„ ì•„ë˜ ë„ë©”ì¸ ì„¤ì • ë“±ì„ ì§„í–‰í•œë‹¤.</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/letsencrypt1.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/scaled-1680-/letsencrypt1.png" alt="letsencrypt1.png" /></a></p>

<h4 id="dns-txt-record-ê°’-ì„¤ì •"><strong>DNS TXT record ê°’ ì„¤ì •</strong></h4>

<p>ë„ë©”ì¸ êµ¬ì…í•œ ê³³(ê°€ë¹„ì•„ ë“±)ì˜ DNS ê´€ë¦¬ë©”ë‰´ë¡œ ì§„ì…í•˜ì—¬ dns txt record ê°’ì„ ì„¤ì •.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´ ê°€ë¹„ì•„ì˜ ê²½ìš° ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ â€˜DNS ë ˆì½”ë“œ ì¶”ê°€â€™ ë©”ë‰´ì—ì„œ TXT ë ˆì½”ë“œë¥¼ ì¶”ê°€ ê°€ëŠ¥</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/letsencrypt2.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/scaled-1680-/letsencrypt2.png" alt="letsencrypt2.png" /></a></p>

<p>í˜¸ìŠ¤íŠ¸ ì»¬ëŸ¼ì—ëŠ” <strong>_acme-challenge</strong> ë§Œ ì…ë ¥</p>

<p>ê°€ë¹„ì•„ì˜ ê²½ìš° ì„¤ì •í•œ ê°’ ì˜ˆì‹œëŠ” ì•„ë˜ ì´ë¯¸ì§€ ì°¸ì¡°. record ê°’ ì•/ë’¤ë¡œ ìŒë”°ì˜´í‘œ ì¶”ê°€.</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/letsencrypt3.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/scaled-1680-/letsencrypt3.png" alt="letsencrypt3.png" /></a></p>

<p>í•´ë‹¹ record ì„¤ì • í›„ ì €ì¥í•˜ì—¬ ë°˜ì˜. ì•„ë˜ commandë¡œ ë„ë©”ì¸ ì„œë²„ì— ë ˆì½”ë“œê°€ ë°˜ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥.</p>

<h4 id="ë„ë©”ì¸-ì„œë²„-ë ˆì½”ë“œ-í™•ì¸"><strong>ë„ë©”ì¸ ì„œë²„ ë ˆì½”ë“œ í™•ì¸</strong></h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nslookup <span class="nt">-type</span><span class="o">=</span>txt _acme-challenge.ccpinfra.xyz
<span class="c"># ë˜ëŠ”</span>
<span class="nv">$ </span>dig +noall +answer _acme-challenge.ccpinfra.xyz txt
</code></pre></div></div>

<p>ì •ìƒ ë°˜ì˜ ì‹œ ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ í™•ì¸ ê°€ëŠ¥.</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/letsencrypt4.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/scaled-1680-/letsencrypt4.png" alt="letsencrypt4.png" /></a></p>

<p>ì´í›„ ì• ê³¼ì •ì˜ dns ë°©ì‹ ì¸ì¦ì„œ ë°œê¸‰ ëŒ€ê¸° í™”ë©´ì—ì„œ enterë¥¼ ëˆŒëŸ¬ ì§„í–‰</p>

<p><a href="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/letsencrypt5.png"><img src="https://bookstack.ccpinfra.xyz:23443/uploads/images/gallery/2021-02/scaled-1680-/letsencrypt5.png" alt="letsencrypt5.png" /></a></p>

<h4 id="ì¸ì¦ì„œ-ì €ì¥-ìœ„ì¹˜">ì¸ì¦ì„œ ì €ì¥ ìœ„ì¹˜</h4>

<p>ì¸ì¦ì„œ ìƒì„± í›„ ì €ì¥ë˜ëŠ” ìœ„ì¹˜:</p>

<ul>
  <li>Certificate is saved at: /etc/letsencrypt/live/{domain name}/fullchain.pem</li>
  <li>Key is saved at:         /etc/letsencrypt/live/{domain name}/privkey.pem</li>
</ul>

<h4 id="ì¸ì¦ì„œ-í™•ì¸">ì¸ì¦ì„œ í™•ì¸</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>certbot-auto certificates
</code></pre></div></div>

<h4 id="ì¸ì¦ì„œ-ì‚­ì œ">ì¸ì¦ì„œ ì‚­ì œ</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>certbot-auto delete
</code></pre></div></div>

<hr />
<h2 id="ì¸ì¦ì„œ-ê°±ì‹ ">ì¸ì¦ì„œ ê°±ì‹ </h2>

<p>Letâ€™s Encryptì˜ ê²½ìš° ë¬´ë£Œì´ì§€ë§Œ ì¸ì¦ì„œ ìœ íš¨ ê¸°ê°„ì´ 3ê°œì›”ë¡œ ì§§ë‹¤.</p>

<p>ì¸ì¦ì„œ ë§Œë£Œ ì „ ë°˜ë“œì‹œ ê°±ì‹ ì„ í•´ì•¼ë§Œ siteì— ì ‘ì†ì´ ì•ˆë˜ëŠ” í˜„ìƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.</p>

<p>google calendarì— 3ê°œì›” ì£¼ê¸°ë¡œ ì•ŒëŒì„ ë“±ë¡í•˜ì—¬ ì¸ì¦ì„œ ê°±ì‹  ê´€ë¦¬ëŠ” í•˜ëŠ” ê²ƒì„ ì¶”ì²œ.</p>

<p>ë˜í•œ ì¸ì¦ì„œë¥¼ manual ë¡œ ìƒì„±í–ˆì„ ê²½ìš° certbot ìë™ ê°±ì‹  ëª…ë ¹ì–´ë¡œëŠ” ê°±ì‹  ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p>ì´ ê²½ìš° ì•„ë˜ ëª…ë ¹ì–´ë¡œ ê°±ì‹ ê°€ëŠ¥</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>certbot <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory <span class="nt">-d</span> <span class="s2">"*.ccpinfra.xyz"</span> <span class="nt">--manual</span> <span class="nt">--preferred-challenges</span> dns-01 certonly
</code></pre></div></div>

<p>ëª…ë ¹ì–´ ì…ë ¥ í›„ ë‚˜ì˜¤ëŠ” DNS TXT record ê°’ì„ ë„ë©”ì¸ êµ¬ì…ì²˜(ì˜ˆë¥¼ ë“¤ì–´ ê°€ë¹„ì•„ ë“±)ì—ì„œ DNS ì„¤ì •ì— ë“¤ì–´ê°€ ì—…ë°ì´íŠ¸ í›„ ì§„í–‰í•œë‹¤.</p>

<blockquote>
  <p>ì¸ì¦ì„œë¥¼ ê°±ì‹ í•˜ì—¬ ìƒˆë¡œìš´ ì¸ì¦ì„œë¥¼ ë°›ì•„ë„ ê¸°ì¡´ ì¸ì¦ì„œëŠ” ë§Œë£Œë˜ì§€ ì•ŠëŠ”ë‹¤.</p>
</blockquote>

<blockquote>
  <p><strong>ì¸ì¦ì„œ ê°±ì‹  ì‹œ ì£¼ì˜ì </strong></p>

  <blockquote>
    <p>ì¸ì¦ì„œ ê°±ì‹  í›„ <code class="language-plaintext highlighter-rouge">/etc/letsencrypt/live</code> ë””ë ‰í† ë¦¬ í•˜ìœ„ì— domain ëª…ìœ¼ë¡œ ë””ë ‰í† ë¦¬ê°€ ìƒì„±ë˜ë©° í•˜ìœ„ì— ì¸ì¦ì„œ íŒŒì¼ë“¤ì´ ìƒì„±ë¨<br />ê¸°ì¡´ ë„ë©”ì¸ëª…ê³¼ ê²¹ì¹˜ê²Œ ë  ì‹œ <code class="language-plaintext highlighter-rouge">domain-0001</code> ë¡œ ë’¤ì— 0001 ê³¼ ê°™ì€ ìˆ«ìê°€ ë¶™ìŒ<br />ë„ë©”ì¸ ê°±ì‹ ì‹œ <code class="language-plaintext highlighter-rouge">*</code> wildcard ìˆëŠ”ì§€ í™•ì¸í• ê²ƒ</p>
  </blockquote>
</blockquote>

<hr />
<h3 id="ì¸ì¦ì„œ-ê°±ì‹ -í›„-ì„œë¹„ìŠ¤ë³„-ì ìš©-ê°€ì´ë“œ">ì¸ì¦ì„œ ê°±ì‹  í›„ ì„œë¹„ìŠ¤ë³„ ì ìš© ê°€ì´ë“œ</h3>

<p>ê¸°ë³¸ì ìœ¼ë¡œ NASì— ì¸ì¦ì„œ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê° ì„œë¹„ìŠ¤ì— ê°€ì ¸ë‹¤ ì‚¬ìš©í•œë‹¤.</p>

<p>ë³¸ ì˜ˆì œì—ì„œëŠ” ì¸ì¦ì„œë¥¼ <code class="language-plaintext highlighter-rouge">/nfs_nas/volumes/ssl</code>ì—ì„œ ê´€ë¦¬</p>

<ul>
  <li>k8sì˜ ê²½ìš° kubernetes secret í˜•íƒœë¡œ ë– ì ¸ ìˆìŒ</li>
  <li>ê·¸ ì™¸ dockerë¡œ ì§ì ‘ ì˜¬ë¼ê°€ìˆëŠ” ê²½ìš° ê° ì„œë¹„ìŠ¤ë³„ ì¸ì¦ì„œ ì •ë³´ ì ìš©</li>
</ul>

<p>ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œíŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ì¸ì¦ì„œ í´ë”ë¡œ ì˜®ê¸´ë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì¸ì¦ì„œ ë³µì‚¬</span>
<span class="nv">$ </span><span class="nb">cp</span> /etc/letsencrypt/live/ccpinfra.xyz-0001/fullchain.pem /nfs_nas/volumes/ssl
<span class="nv">$ </span><span class="nb">cp</span> /etc/letsencrypt/live/ccpinfra.xyz-0001/privkey.pem

<span class="c"># ì¸ì¦ì„œ í¬ë§· ë³€í™˜</span>
<span class="nv">$ </span>openssl x509 <span class="nt">-inform</span> PEM <span class="nt">-in</span> fullchain.pem <span class="nt">-out</span> ccpinfra.xyz.crt
<span class="nv">$ </span>openssl rsa <span class="nt">-in</span> privkey.pem <span class="nt">-text</span> <span class="nt">-text</span> <span class="o">&gt;</span> ccpinfra.xyz.key
</code></pre></div></div>

<blockquote>
  <p>ê¸°ì¡´ì˜ ì¸ì¦ì„œëŠ” ë°±ì—…í•  ê²ƒ</p>
</blockquote>

<p>ì•„ë˜ëŠ” ì„œë¹„ìŠ¤ë³„ ì¸ì¦ì„œ ì ìš© ì„¤ì •ì´ë©° ì„œë¹„ìŠ¤, í™˜ê²½ë³„ë¡œ ìƒì´í•  ìˆ˜ ìˆìŒ
ì°¸ê³ </p>

<ol>
  <li>bookstack
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim docker-compose.yaml
</code></pre></div>    </div>
    <p>```yaml
version: â€œ2â€
services:
  bookstack:
 image: ghcr.io/linuxserver/bookstack
 container_name: bookstack
 â€¦
 volumes:</p>
    <ul>
      <li>/nfs_nas/volumes/ssl:/config/keys # ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì¶”ê°€
 â€¦
```
ìœ„ì™€ ê°™ì´ ì„¤ì •ì‹œ ì»¨í…Œì´ë„ˆì˜ <code class="language-plaintext highlighter-rouge">/config/keys</code>ì— ì¸ì¦ì„œê°€ ìˆìŒ</li>
    </ul>
  </li>
</ol>

<p>ê·¸ ì™¸ ì„¤ì • ë° ì ìš©ë°©ë²•ì€ <a href="https://bookstack.ccpinfra.xyz:23443/books/mobilitymakers-infra/page/bookstack-ssl">Bookstack SSL ì¸ì¦ì„œ ì„¤ì •</a> ì°¸ì¡°</p>

<ol>
  <li>gitlab
```yaml
version: â€˜3â€™</li>
</ol>

<p>services:
  gitlab:
    image: â€˜gitlab/gitlab-ce:latestâ€™
    â€¦
    environment:
      TZ: â€œAsia/Seoulâ€
      GITLAB_OMNIBUS_CONFIG: |
        letsencrypt[â€˜enableâ€™] = false
        external_url â€˜https://gitlab.ccpinfra.xyz:20443â€™
        nginx[â€˜ssl_certificateâ€™] = â€œ/etc/gitlab/ssl/ccpinfra.xyz.crtâ€		# ë³€ê²½
        nginx[â€˜ssl_certificate_keyâ€™] = â€œ/etc/gitlab/ssl/ccpinfra.xyz.keyâ€	# ë³€ê²½
        nginx[â€˜redirect_http_to_httpsâ€™] = true
        â€¦
    ports:
      - â€˜20780:20443â€™
      - â€˜20443:20443â€™
      - â€˜20722:22â€™
    volumes:
      - â€˜/data/docker_volumes/gitlab/config:/etc/gitlabâ€™
      - â€˜/data/docker_volumes/gitlab/logs:/var/log/gitlabâ€™
      - â€˜/data/docker_volumes/gitlab/data:/var/opt/gitlabâ€™
      - â€˜/nfs_nas/volumes/ssl:/etc/gitlab/sslâ€™	# ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì¶”ê°€</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ìœ„ì™€ ê°™ì´ ì„¤ì •ì‹œ ì»¨í…Œì´ë„ˆì˜ `/etc/gitlab/ssl`ì— ì¸ì¦ì„œê°€ ìˆê³  ê·¸ ì•ˆì˜ `ccpinfra.xyz.crt`, `ccpinfra.xyz.key`ë¥¼ ë¬¼ê³  ê°

ê·¸ ì™¸ ì„¤ì • ë° ì ìš©ë°©ë²•ì€ [Gitlab ì„¤ì •](https://bookstack.ccpinfra.xyz:23443/books/mobilitymakers-infra/page/gitlab-f34#bkmrk-nginx-ssl-%EC%84%A4%EC%A0%95) ì°¸ì¡°

3. k8s ingress
```shell
# ì‚¬ìš©ì¤‘ì¸ kubernetes.io/tls secret í™•ì¸
$ kubectl get secret

# k8s secret ì‚­ì œ
$ kubectl delete secret secret-tls

# ìƒˆ ì¸ì¦ì„œë¡œ k8s secret ìƒì„±
$ kubectl create secret tls secret-tls --cert /nfs_nas/volumes/ssl/ccpinfra.xyz.crt --key /nfs_nas/volumes/ssl/ccpinfra.xyz.key

# ìƒì„±ëœ kubernetes.io/tls secret í™•ì¸
$ kubectl describe secret secret-tls
</code></pre></div></div>

<p>ê·¸ ì™¸ êµ¬ì¡° ë° ì„¤ì •ì€ <a href="https://bookstack.ccpinfra.xyz:23443/books/mobilitymakers-infra/page/kubernetes-ingress-nginx-https">Kubernetes ingress nginx https ì¸ì¦ì„œ ì ìš©</a> ì°¸ì¡°</p>

<hr />
<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="1-neterr_cert_common_name_invalid">1. NET::ERR_CERT_COMMON_NAME_INVALID</h3>

<p>ì¸ì¦ì„œ ê°±ì‹  ë° ë°œê¸‰ í›„ì— ì¸ì¦ì„œ ì ìš©ì´ ì„±ê³µì ìœ¼ë¡œ ë˜ì—ˆìœ¼ë‚˜ <code class="language-plaintext highlighter-rouge">NET::ERR_CERT_COMMON_NAME_INVALID</code>ë¡œ ì¸ì¦ì„œê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ</p>

<h4 id="ì¸ì¦ì„œì˜-ì£¼ì†Œì™€-ì¸ì¦ì„œê°€-ì ìš©ëœ-ë„ë©”ì¸ì˜-ì£¼ì†Œê°€-ì¼ì¹˜í•˜ì§€-ì•Šì„-ë•Œ-ë°œìƒí•˜ëŠ”-ì˜¤ë¥˜">ì¸ì¦ì„œì˜ ì£¼ì†Œì™€ ì¸ì¦ì„œê°€ ì ìš©ëœ ë„ë©”ì¸ì˜ ì£¼ì†Œê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜</h4>

<ol>
  <li>ì¸ì¦ì„œì˜ ë„ë©”ì¸ ì£¼ì†Œê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">*</code> wildcardê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li>
  <li>ë„ë©”ì¸ ì£¼ì†Œê°€ ì •ìƒì¸ ê²½ìš° ì „ì„¸ê³„ì˜ DNS ì„œë²„ì— ì ìš©ì´ ë°”ë¡œ ë˜ì§€ ì•Šê³  ì‹œê°„ì´ ì–´ëŠì •ë„ ì†Œìš”ë˜ì–´ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ ê¸°ë‹¤ë¦¬ë©´ í•´ê²°ëœë‹¤.</li>
</ol>

<h4 id="ë„ë©”ì¸-ì„œë²„-ë ˆì½”ë“œ-í™•ì¸-1">ë„ë©”ì¸ ì„œë²„ ë ˆì½”ë“œ í™•ì¸</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nslookup <span class="nt">-type</span><span class="o">=</span>txt _acme-challenge.confluence.grigri.xyz
<span class="c"># ë˜ëŠ”</span>
<span class="nv">$ </span>dig +noall +answer _acme-challenge.confluence.grigri.xyz txt
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Authoritative answers can be found from:</code>ì— ë¦¬ìŠ¤íŠ¸ë¡œ ë„ë©”ì¸ ì„œë²„ ì •ë³´ê°€ ë‚˜ì˜¤ë©´ ë“±ë¡ì´ ì™„ë£Œëœ ê²ƒ</p>

<hr />

<h2 id="reference">Reference</h2>

<ol>
  <li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a></li>
  <li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">Ingress Controllers</a></li>
  <li><a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secret</a></li>
  <li><a href="https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/">Certified Kubernetes Administrator(CKA) with Practice Tests</a></li>
</ol>
:ET