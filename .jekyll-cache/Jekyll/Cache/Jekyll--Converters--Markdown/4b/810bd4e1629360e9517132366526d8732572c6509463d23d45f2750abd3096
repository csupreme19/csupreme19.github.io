I"<h1 id="apt-자동-업그레이드-비활성화unattended-upgrade">Apt 자동 업그레이드 비활성화(Unattended upgrade)</h1>

<p><img src="/assets/img/titles/ubuntu-logo.svg" alt="ubuntu-logo.svg" /></p>

<hr />
<h3 id="개요">개요</h3>

<p>Ubuntu 16, 18, 20에서는 기본적으로 Apt 패키지의 Unattended upgrade라는 자동 업데이트 타이머가 활성화 되어 있다. (크론잡 형태)</p>

<p>리눅스 커널, SSH, OpenSSL 등의 보안 패치를 위하여 자동으로  업데이트를 진행하도록 기본 설정되어 있다.</p>

<p>보안 취약점을 패치한다는 취지에서는 좋지만 Install, Upgrade된 버전을 사용하려면 서버 재시작이 필수이며</p>

<p>커널 업데이트로 인하여 OS레벨에서의 문제점이나 장애가 발생할 수 있다.</p>

<p>이런 장애는 파악하기 매우 어려우므로 운영 관점에서는 해당 기능을 비활성화 하는 것이 좋다.</p>

<h3 id="apt-로그-확인">apt 로그 확인</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /var/log/apt
<span class="nv">$ </span><span class="nb">tail </span>history.log
</code></pre></div></div>

<h3 id="apt-daily-비활성화">apt-daily 비활성화</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl stop apt-daily.timer
<span class="nv">$ </span>systemctl stop apt-daily-upgrade.timer
<span class="nv">$ </span>systemctl disable apt-daily.timer
<span class="nv">$ </span>systemctl disable apt-daily.service
<span class="nv">$ </span>systemctl disable apt-daily-upgrade.timer
<span class="nv">$ </span>systemctl disable apt-daily-upgrade.service
</code></pre></div></div>

<h3 id="unattended-upgrade-비활성화">unattended-upgrade 비활성화</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/apt/apt.conf.d/20auto-upgrades
APT::Periodic::Update-Package-Lists <span class="s2">"0"</span><span class="p">;</span>
APT::Periodic::Download-Upgradeable-Packages <span class="s2">"0"</span><span class="p">;</span>
APT::Periodic::AutocleanInterval <span class="s2">"0"</span><span class="p">;</span>
APT::Periodic::Unattended-Upgrade <span class="s2">"0"</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="비활성화-확인">비활성화 확인</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl status apt-daily.timer
<span class="nv">$ </span>systemctl status apt-daily.service
<span class="nv">$ </span>systemctl status apt-daily-upgrade.timer
<span class="nv">$ </span>systemctl status apt-daily-upgrade.service
<span class="nv">$ </span>systemctl list-unit-files | <span class="nb">grep </span>apt-daily

<span class="nv">$ </span>apt-config dump | <span class="nb">grep </span>Update-Package-Lists
</code></pre></div></div>

:ET